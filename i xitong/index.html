<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é‡ç”Ÿä¹‹è·¯">
    <title>æœ±æ ¼è¾‰:é‡ç”Ÿä¹‹è·¯</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --primary: #c41e3a; --primary-dark: #8b0000; --success: #228b22; --gold: #ffd700; --dark: #1a1a2e; --card: rgba(26,26,46,0.9); --text: #f0f0f0; --text-dim: #a0a0a0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, rgba(13,27,42,0.95) 0%, rgba(27,38,59,0.95) 50%, rgba(45,58,74,0.95) 100%), 
                        url('christmas-bg.png') center/cover fixed; 
            min-height: 100vh; 
            color: var(--text); 
            padding-bottom: env(safe-area-inset-bottom); 
            overflow-x: hidden; 
        }
        
        /* å¤§é›ªèŠ± */
        .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; overflow: hidden; }
        .snowflake { position: absolute; top: -60px; color: white; text-shadow: 0 0 15px rgba(255,255,255,0.9); animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translateY(-60px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0.3; } }
        .snowflake:nth-child(1) { left: 5%; animation-duration: 12s; font-size: 32px; }
        .snowflake:nth-child(2) { left: 12%; animation-duration: 16s; animation-delay: 1s; font-size: 40px; }
        .snowflake:nth-child(3) { left: 20%; animation-duration: 14s; animation-delay: 2s; font-size: 28px; }
        .snowflake:nth-child(4) { left: 28%; animation-duration: 18s; animation-delay: 0.5s; font-size: 36px; }
        .snowflake:nth-child(5) { left: 36%; animation-duration: 13s; animation-delay: 3s; font-size: 24px; }
        .snowflake:nth-child(6) { left: 44%; animation-duration: 15s; animation-delay: 1.5s; font-size: 34px; }
        .snowflake:nth-child(7) { left: 52%; animation-duration: 17s; animation-delay: 2.5s; font-size: 30px; }
        .snowflake:nth-child(8) { left: 60%; animation-duration: 14s; animation-delay: 0.8s; font-size: 42px; }
        .snowflake:nth-child(9) { left: 68%; animation-duration: 19s; animation-delay: 3.5s; font-size: 26px; }
        .snowflake:nth-child(10) { left: 76%; animation-duration: 12s; animation-delay: 1.2s; font-size: 32px; }
        .snowflake:nth-child(11) { left: 84%; animation-duration: 15s; animation-delay: 4s; font-size: 38px; }
        .snowflake:nth-child(12) { left: 92%; animation-duration: 13s; animation-delay: 2.2s; font-size: 28px; }
        
        /* åœ£è¯ç¯ */
        .christmas-lights { position: fixed; top: 0; left: 0; width: 100%; height: 35px; display: flex; justify-content: space-around; z-index: 999; padding: 8px; background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent); }
        .light { width: 14px; height: 14px; border-radius: 50%; animation: glow 1.5s ease-in-out infinite alternate; }
        .light:nth-child(odd) { background: #ff0000; box-shadow: 0 0 10px #ff0000; }
        .light:nth-child(even) { background: #00ff00; animation-delay: 0.75s; box-shadow: 0 0 10px #00ff00; }
        .light:nth-child(3n) { background: #ffd700; animation-delay: 0.5s; box-shadow: 0 0 10px #ffd700; }
        @keyframes glow { 0% { box-shadow: 0 0 5px currentColor; opacity: 0.5; } 100% { box-shadow: 0 0 20px currentColor; opacity: 1; } }
        
        /* åœ£è¯æ ‘è£…é¥° */
        .tree-decor { position: fixed; z-index: 5; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4)); animation: float 3s ease-in-out infinite; }
        .tree-1 { bottom: 15px; left: 15px; width: 90px; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-12px) rotate(3deg); } }
        
        /* åœ£è¯è€äºº */
        .santa-decor { position: fixed; top: 55px; right: 15px; width: 75px; z-index: 5; animation: santaWave 2s ease-in-out infinite; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5)); border-radius: 50%; }
        @keyframes santaWave { 0%, 100% { transform: rotate(-5deg) scale(1); } 50% { transform: rotate(5deg) scale(1.08); } }
        
        /* éŸ³ä¹æŒ‰é’® */
        .music-btn { position: fixed; top: 50px; left: 15px; width: 55px; height: 55px; background: linear-gradient(135deg, var(--primary), var(--success)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; z-index: 1001; cursor: pointer; border: 3px solid var(--gold); box-shadow: 0 4px 15px rgba(255,215,0,0.4); }
        .music-btn.playing { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 10px var(--gold); } 50% { box-shadow: 0 0 30px var(--gold); } }
        
        /* æ–°å¢ï¼šç­‰çº§ç³»ç»Ÿæ ·å¼ */
        .level-badge { display: inline-block; background: linear-gradient(135deg, var(--gold), #ffed4e); color: var(--dark); padding: 4px 12px; border-radius: 15px; font-weight: bold; font-size: 14px; margin-left: 10px; box-shadow: 0 2px 8px rgba(255,215,0,0.4); }
        .level-progress { margin: 15px 0; }
        .level-info-text { font-size: 12px; color: var(--text-dim); margin-top: 5px; text-align: center; }
        
        /* æ–°å¢ï¼šé‡‘é’±ç®¡ç†æ ·å¼ */
        .money-display { background: linear-gradient(135deg, #2ecc71, #27ae60); padding: 15px; border-radius: 15px; margin: 10px 0; text-align: center; box-shadow: 0 4px 12px rgba(46,204,113,0.3); }
        .money-amount { font-size: 32px; font-weight: bold; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .money-label { font-size: 12px; color: rgba(255,255,255,0.9); margin-top: 5px; }
        .transaction-item { background: var(--card); padding: 12px; border-radius: 10px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .transaction-desc { flex: 1; }
        .transaction-amount { font-weight: bold; font-size: 16px; }
        .transaction-amount.income { color: #2ecc71; }
        .transaction-amount.expense { color: #e74c3c; }
        .transaction-date { font-size: 11px; color: var(--text-dim); margin-top: 3px; }
        
        /* æ–°å¢ï¼šè‡ªå®šä¹‰å†…å®¹æ ·å¼ */
        .custom-note { background: var(--card); padding: 15px; border-radius: 12px; margin: 10px 0; border-left: 4px solid var(--primary); }
        .custom-note-title { font-weight: bold; margin-bottom: 8px; color: var(--gold); }
        .custom-note-content { font-size: 14px; line-height: 1.6; white-space: pre-wrap; }
        .custom-goal { background: linear-gradient(135deg, rgba(196,30,58,0.2), rgba(139,0,0,0.2)); padding: 12px; border-radius: 10px; margin: 8px 0; border: 1px solid var(--primary); }
        .goal-checkbox { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--gold); border-radius: 4px; margin-right: 10px; vertical-align: middle; cursor: pointer; }
        .goal-checkbox.checked { background: var(--gold); }
        .goal-checkbox.checked::after { content: 'âœ“'; color: var(--dark); font-weight: bold; display: block; text-align: center; line-height: 16px; }
        
        .app-container { max-width: 500px; margin: 0 auto; padding: 20px 15px; padding-top: calc(60px + env(safe-area-inset-top)); position: relative; z-index: 10; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 28px; background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff, #ff6b6b); background-size: 400%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: rainbow 5s ease infinite; }
        @keyframes rainbow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .header .subtitle { color: var(--text-dim); font-size: 14px; }
        .header .christmas-greeting { color: var(--gold); font-size: 13px; margin-top: 8px; animation: twinkle 2s ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .day-display { display: inline-block; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); padding: 10px 25px; border-radius: 25px; font-weight: bold; margin-top: 12px; border: 3px solid var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.4); }
        
        .nav-tabs { display: flex; gap: 6px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .nav-tab { flex-shrink: 0; padding: 10px 14px; background: var(--card); border: 1px solid rgba(255,215,0,0.2); border-radius: 12px; color: var(--text-dim); font-size: 13px; cursor: pointer; }
        .nav-tab.active { background: linear-gradient(135deg, var(--primary), var(--success)); color: white; border-color: var(--gold); box-shadow: 0 0 15px rgba(255,215,0,0.4); }
        
        .card { background: var(--card); border-radius: 18px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,215,0,0.15); box-shadow: 0 8px 25px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), var(--success), var(--gold), var(--primary)); background-size: 200%; animation: shimmer 3s linear infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .card-title { font-size: 17px; font-weight: bold; margin-bottom: 15px; }
        
        .stat-item { margin-bottom: 14px; }
        .stat-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; }
        .stat-bar { height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; }
        .rank-progress-container { width:100%; max-width:300px; margin:0 auto; }
        .rank-progress-bar { height:16px; background:rgba(255,255,255,0.1); border-radius:8px; overflow:hidden; }
        .rank-progress-fill { height:100%; background:linear-gradient(90deg, var(--gold), #FFD700); transition:width 0.5s; box-shadow:0 0 10px var(--gold); }
        
        /* v5.0 æ®µä½å›¾æ ‡å¢å¼º */
        #rankIcon { 
            font-size:64px; 
            margin-bottom:10px; 
            filter: drop-shadow(0 0 20px currentColor);
            animation: rankGlow 2s ease-in-out infinite alternate;
        }
        @keyframes rankGlow {
            0% { filter: drop-shadow(0 0 10px currentColor); transform: scale(1); }
            100% { filter: drop-shadow(0 0 25px currentColor); transform: scale(1.05); }
        }
        #rankTier {
            font-size:12px;
            color:var(--text-dim);
            margin-bottom:5px;
            letter-spacing:2px;
            text-transform:uppercase;
        }
        #rankName {
            font-size:28px;
            font-weight:bold;
            margin-bottom:5px;
            text-shadow: 0 0 15px currentColor;
        }
        #rankDesc {
            font-size:14px;
            color:var(--text-dim);
            margin-bottom:20px;
            font-style:italic;
        }
        .equipment-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:15px; }
        .equipment-slot { background:rgba(255,255,255,0.05); border:2px solid rgba(255,215,0,0.3); border-radius:12px; padding:15px; text-align:center; cursor:pointer; transition:all 0.3s; position:relative; }
        .equipment-slot:hover { border-color:var(--gold); background:rgba(255,215,0,0.1); transform:translateY(-2px); }
        .slot-icon { font-size:32px; margin-bottom:8px; }
        .slot-name { font-size:12px; color:var(--text-dim); margin-bottom:8px; }
        .slot-item { font-size:14px; font-weight:bold; color:var(--text); min-height:20px; }
        .slot-item.empty { color:var(--text-dim); font-weight:normal; }
        .slot-rarity { position:absolute; top:8px; right:8px; font-size:10px; padding:2px 6px; border-radius:4px; font-weight:bold; }
        .slot-rarity.ssr { background:#ff6b6b; color:white; }
        .slot-rarity.sr { background:#a29bfe; color:white; }
        .slot-rarity.r { background:#74b9ff; color:white; }
        .slot-rarity.n { background:#b2bec3; color:white; }
        .equipment-inventory-item { background:rgba(255,255,255,0.05); border-radius:8px; padding:12px; margin-bottom:10px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
        .equipment-inventory-item:hover { background:rgba(255,215,0,0.1); }
        .boss-card { background:rgba(255,255,255,0.05); border-left:4px solid #ff6b6b; border-radius:12px; padding:15px; margin-bottom:15px; }
        .boss-card-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
        .boss-card-title { font-size:18px; font-weight:bold; }
        .boss-difficulty { color:var(--gold); font-size:14px; }
        .boss-desc { font-size:13px; color:var(--text-dim); margin-bottom:10px; }
        .boss-tips { font-size:12px; background:rgba(255,215,0,0.1); padding:10px; border-radius:6px; margin-bottom:10px; }
        .boss-stats { display:flex; gap:15px; font-size:12px; }
        .boss-stat { color:var(--text-dim); }
        .boss-stat strong { color:var(--text); }
        .achievement-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px; }
        .achievement-card { background:rgba(255,255,255,0.05); border-radius:12px; padding:15px; border-left:4px solid var(--text-dim); }
        .achievement-card.unlocked { border-left-color:var(--gold); background:rgba(255,215,0,0.1); }
        .achievement-icon { font-size:32px; margin-bottom:8px; }
        .achievement-name { font-weight:bold; margin-bottom:5px; }
        .achievement-desc { font-size:12px; color:var(--text-dim); margin-bottom:8px; }
        .achievement-reward { font-size:12px; color:var(--gold); }
        .stat-fill { height: 100%; border-radius: 6px; transition: width 0.5s; position: relative; }
        .stat-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shine 2s linear infinite; }
        @keyframes shine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .stat-fill.hp { background: linear-gradient(90deg, #c41e3a, #ff6b6b); }
        .stat-fill.mp { background: linear-gradient(90deg, #1e90ff, #87ceeb); }
        .stat-fill.exp { background: linear-gradient(90deg, #ffd700, #ffec8b); }
        .stat-fill.attr { background: linear-gradient(90deg, #228b22, #90ee90); }
        
        .debuff-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .debuff-tag { padding: 7px 12px; border-radius: 15px; font-size: 11px; cursor: pointer; }
        .debuff-tag.active { background: rgba(196,30,58,0.3); color: #ff9999; border: 1px solid rgba(196,30,58,0.5); }
        .debuff-tag.cleared { background: rgba(34,139,34,0.3); color: #90ee90; border: 1px solid rgba(34,139,34,0.5); text-decoration: line-through; }
        
        .log-input-group { margin-bottom: 18px; }
        .log-label { font-size: 13px; color: var(--gold); margin-bottom: 8px; display: block; font-weight: 600; }
        .log-input { width: 100%; padding: 14px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: var(--text); font-size: 15px; }
        .log-input:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 15px rgba(255,215,0,0.3); }
        .time-input-group { display: flex; gap: 10px; align-items: center; }
        .time-input { flex: 1; padding: 14px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: var(--text); font-size: 18px; text-align: center; }
        .time-separator { font-size: 24px; color: var(--gold); font-weight: bold; }
        .time-label { font-size: 12px; color: var(--text-dim); text-align: center; margin-top: 5px; }
        
        .rating-selector { display: flex; gap: 8px; flex-wrap: wrap; }
        .rating-btn { width: 42px; height: 42px; border: 2px solid rgba(255,215,0,0.3); background: rgba(255,255,255,0.05); border-radius: 12px; color: var(--text); font-size: 15px; font-weight: bold; cursor: pointer; }
        .rating-btn.selected { background: linear-gradient(135deg, var(--primary), var(--success)); border-color: var(--gold); box-shadow: 0 0 15px rgba(255,215,0,0.4); }
        
        .save-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--primary), var(--success)); border: 3px solid var(--gold); border-radius: 15px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 6px 20px rgba(196,30,58,0.4); }
        
        .task-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
        .task-item.completed { border-left-color: var(--success); opacity: 0.7; }
        .task-item.locked { border-left-color: #666; opacity: 0.5; background: rgba(255,255,255,0.02); }
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .task-title { font-weight: bold; font-size: 14px; }
        .task-exp { background: linear-gradient(135deg, var(--gold), #ffec8b); color: #333; padding: 4px 10px; border-radius: 10px; font-size: 11px; font-weight: bold; }
        .task-check { display: flex; align-items: center; gap: 12px; padding: 10px 0; font-size: 14px; }
        .checkbox { width: 26px; height: 26px; border: 2px solid var(--gold); border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .checkbox.checked { background: linear-gradient(135deg, var(--success), #90ee90); border-color: var(--success); }
        .checkbox.checked::after { content: 'âœ“'; color: white; font-size: 16px; font-weight: bold; }
        
        .history-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .history-date { font-size: 13px; color: var(--gold); margin-bottom: 10px; font-weight: 600; }
        .history-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 12px; }
        .history-stat { text-align: center; }
        .history-stat-value { font-size: 22px; font-weight: bold; color: var(--gold); }
        
        .boss-warning { background: linear-gradient(135deg, rgba(196,30,58,0.2), rgba(139,0,0,0.2)); border: 1px solid rgba(196,30,58,0.4); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .boss-title { font-size: 16px; font-weight: bold; margin-bottom: 12px; color: #ff9999; }
        .boss-strategy { font-size: 13px; color: var(--text-dim); line-height: 1.8; }
        
        .quote-box { background: linear-gradient(135deg, rgba(196,30,58,0.15), rgba(34,139,34,0.15)); border-left: 4px solid var(--gold); padding: 20px; margin: 15px 0; font-style: italic; font-size: 15px; line-height: 1.8; border-radius: 0 15px 15px 0; }
        .quote-author { text-align: right; color: var(--gold); font-size: 13px; margin-top: 12px; font-style: normal; font-weight: 600; }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1100; align-items: center; justify-content: center; padding: 20px; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: linear-gradient(135deg, var(--dark), #2a2a4a); border-radius: 25px; padding: 30px; max-width: 320px; width: 100%; text-align: center; border: 3px solid var(--gold); box-shadow: 0 0 40px rgba(255,215,0,0.4); position: relative; }
        .modal-content::before { content: 'ğŸ„'; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 50px; }
        .modal-icon { font-size: 65px; margin: 15px 0; }
        .modal-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; color: var(--gold); }
        .modal-desc { color: var(--text-dim); font-size: 14px; margin-bottom: 25px; }
        .modal-btn { padding: 14px 40px; background: linear-gradient(135deg, var(--primary), var(--success)); border: 2px solid var(--gold); border-radius: 15px; color: white; font-size: 15px; font-weight: bold; cursor: pointer; }
        
        .fab { position: fixed; bottom: calc(30px + env(safe-area-inset-bottom)); right: 20px; width: 65px; height: 65px; background: linear-gradient(135deg, var(--primary), var(--success)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 0 6px 25px rgba(196,30,58,0.5); cursor: pointer; z-index: 50; border: 3px solid var(--gold); }
        .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:100; display:flex; align-items:center; justify-content:center; padding:20px; }
        .modal-content { background:var(--card); border-radius:16px; max-height:90vh; overflow-y:auto; width:100%; box-shadow:0 10px 40px rgba(0,0,0,0.5); }
        .modal-header { display:flex; justify-content:space-between; align-items:center; padding:20px; border-bottom:1px solid rgba(255,255,255,0.1); }
        .modal-header h2 { margin:0; font-size:20px; }
        .modal-close { background:none; border:none; font-size:32px; color:var(--text); cursor:pointer; padding:0; width:40px; height:40px; }
        .modal-body { padding:20px; }
        
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-dim); }
        .empty-icon { font-size: 55px; margin-bottom: 15px; opacity: 0.5; }
        
        .social-contact { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .contact-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .contact-name { font-weight: bold; font-size: 15px; }
        .contact-type { font-size: 11px; padding: 4px 10px; background: linear-gradient(135deg, var(--primary), var(--success)); border-radius: 10px; }
        .intimacy-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .intimacy-fill { height: 100%; background: linear-gradient(90deg, #ff69b4, #ff1493); border-radius: 4px; }
        
        .achievement-item { display: flex; align-items: center; gap: 12px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 10px; }
        .achievement-item.unlocked { background: rgba(34,139,34,0.15); border: 1px solid rgba(34,139,34,0.4); }
        .achievement-icon { width: 48px; height: 48px; background: rgba(255,215,0,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .achievement-info { flex: 1; }
        .achievement-name { font-weight: bold; font-size: 14px; }
        .achievement-desc { font-size: 12px; color: var(--text-dim); margin-top: 3px; }
        
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }
        input[type="number"] { -moz-appearance: textfield; }
        
        /* v5.0 æ®µä½ç³»ç»Ÿæ ·å¼ */
        .rank-badge { 
            width: 80px; 
            height: 80px; 
            margin: 0 auto 15px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 48px; 
            position: relative;
            animation: rankGlow 2s ease-in-out infinite;
        }
        @keyframes rankGlow {
            0%, 100% { filter: drop-shadow(0 0 10px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor); }
        }
        .rank-tier-label { 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            opacity: 0.7;
            font-weight: 500;
        }
    </style>

</head>
<body>
    <audio id="bgMusic" loop><source src="bgm.mp3" type="audio/mpeg"></audio>
    
    <div class="snowflakes">
        <div class="snowflake">â„</div><div class="snowflake">â…</div><div class="snowflake">â†</div>
        <div class="snowflake">â„</div><div class="snowflake">â…</div><div class="snowflake">â†</div>
        <div class="snowflake">â„</div><div class="snowflake">â…</div><div class="snowflake">â†</div>
        <div class="snowflake">â„</div><div class="snowflake">â…</div><div class="snowflake">â†</div>
    </div>
    
    <div class="christmas-lights">
        <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
        <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
        <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
        <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
    </div>
    
    <div class="music-btn" id="musicBtn" onclick="toggleMusic()">ğŸ”‡</div>
    <img class="tree-decor tree-1" src="data:image/jpeg;base64,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" alt="åœ£è¯æ ‘">
    <img class="santa-decor" src="data:image/jpeg;base64,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" alt="åœ£è¯è€äºº">

    <div class="app-container">
        <div class="header">
            <h1>ğŸ® é‡ç”Ÿä¹‹è·¯ â­</h1>
            <div class="subtitle">æœ±æ ¼è¾‰ | <span id="headerLevel">Lv.1</span></div>
            <div class="christmas-greeting">ğŸ… åœ£è¯å¿«ä¹!æ„¿ä½ çš„é‡ç”Ÿä¹‹è·¯å……æ»¡å¸Œæœ› ğŸŒŸ</div>
            <div class="day-display" id="dayDisplay">ğŸ„ Day 1 ğŸ</div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="status">ğŸ¯ çŠ¶æ€</button>
            <button class="nav-tab" data-section="daily">ğŸ“ æ¯æ—¥</button>
            <button class="nav-tab" data-section="tasks">âš”ï¸ ä»»åŠ¡</button>
            <button class="nav-tab" data-section="equipment">ğŸ’ è£…å¤‡</button>
            <button class="nav-tab" data-section="social">ğŸ‘¥ ç¤¾äº¤</button>
            <button class="nav-tab" data-section="achievements">ğŸ† æˆå°±</button>
            <button class="nav-tab" data-section="history">ğŸ“Š è®°å½•</button>
            <button class="nav-tab" data-section="finance">ğŸ’° è´¢åŠ¡</button>
            <button class="nav-tab" data-section="boss">ğŸ‘¹ Boss</button>
            <button class="nav-tab" data-section="settings">âš™ï¸ è®¾ç½®</button>
        </div>
        
        <div class="section active" id="status">
            <div class="card">
                <div class="card-title">â­ ç­‰çº§ç³»ç»Ÿ</div>
                <div class="level-progress">
                    <div style="text-align:center; font-size:42px; font-weight:bold; color:var(--gold); margin-bottom:10px">
                        Lv.<span id="currentLevel">1</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-header">
                            <span>ç»éªŒå€¼</span>
                            <span id="levelExpValue">0/100</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill exp" id="levelExpBar" style="width:0%"></div>
                        </div>
                    </div>
                    <div class="level-info-text" id="levelBonus">å‡çº§å¥–åŠ±: HP+10, MP+10, å…¨å±æ€§+2</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ† æ®µä½ç³»ç»Ÿ</div>
                <div style="text-align:center; padding:20px">
                    <div class="rank-badge" id="rankBadge">
                        <img id="rankIcon" src="rank_iron.png" style="width:100%; height:100%; object-fit:contain;">
                    </div>
                    <div class="rank-tier-label" id="rankTier">æ··å­é»‘é“</div>
                    <div style="font-size:28px; font-weight:bold; margin:8px 0" id="rankName">é»‘é“III</div>
                    <div style="font-size:13px; color:var(--text-dim); margin-bottom:20px" id="rankDesc">åˆšå¼€å§‹ï¼Œæ··æ—¥å­çŠ¶æ€</div>
                    <div class="rank-progress-container">
                        <div class="rank-progress-bar">
                            <div class="rank-progress-fill" id="rankProgress" style="width:0%"></div>
                        </div>
                        <div style="font-size:12px; color:var(--text-dim); margin-top:8px" id="rankProgressText">
                            è·ç¦»ä¸‹ä¸€æ®µä½è¿˜éœ€ <span id="rankLevelGap">1</span> çº§
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card"><div class="card-title">â¤ï¸ ç”Ÿå‘½çŠ¶æ€</div>
                <div class="stat-item"><div class="stat-header"><span>â¤ï¸ HP</span><span id="hpValue">60/100</span></div><div class="stat-bar"><div class="stat-fill hp" id="hpBar" style="width:60%"></div></div></div>
                <div class="stat-item"><div class="stat-header"><span>ğŸ’™ MP</span><span id="mpValue">20/100</span></div><div class="stat-bar"><div class="stat-fill mp" id="mpBar" style="width:20%"></div></div></div>
                <div class="stat-item"><div class="stat-header"><span>â­ EXP</span><span id="expValue">0/1000</span></div><div class="stat-bar"><div class="stat-fill exp" id="expBar" style="width:0%"></div></div></div>
            </div>
            <div class="card"><div class="card-title">ğŸ“Š å…«ç»´å±æ€§</div><div id="attributesList"></div></div>
            <div class="card"><div class="card-title">âš ï¸ çŠ¶æ€æ•ˆæœ</div><div class="debuff-list" id="debuffList"></div></div>
            <div class="card"><div class="card-title">ğŸ’ è£…å¤‡æ </div><div id="equipmentList"></div></div>
        </div>
        
        <div class="section" id="daily">
            <div class="card">
                <div class="card-title">â­ ä»Šæ—¥æ´»è·ƒåº¦</div>
                <div style="text-align:center; padding:20px">
                    <div style="font-size:48px; font-weight:bold; color:var(--gold); margin-bottom:10px">
                        <span id="activeScore">0</span>/100
                    </div>
                    <div style="font-size:14px; color:var(--text-dim); margin-bottom:15px" id="activeLevel">ğŸ”´ æ··å­</div>
                    <div class="rank-progress-bar" style="max-width:100%; margin-bottom:15px">
                        <div id="activeProgress" style="height:100%; background:linear-gradient(90deg, #ff4444, #ffaa00, #44ff44); transition:width 0.5s; width:0%"></div>
                    </div>
                    <div style="font-size:12px; color:var(--text-dim)" id="activeReward">å®Œæˆä»»åŠ¡æå‡æ´»è·ƒåº¦</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ  ç”Ÿæ´»åŸºç¡€ (35åˆ†)</div>
                <div class="task-check"><div class="checkbox" id="check_washFace" onclick="toggleLifeHabit('washFace')"></div><span>æ—©ä¸Šæ´—è„¸åˆ·ç‰™</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+10åˆ†</span></div>
                <div class="task-check"><div class="checkbox" id="check_breakfast" onclick="toggleLifeHabit('breakfast')"></div><span>åƒæ—©é¤</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+5åˆ†</span></div>
                <div class="task-check"><div class="checkbox" id="check_lunch" onclick="toggleLifeHabit('lunch')"></div><span>åƒåˆé¤</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+5åˆ†</span></div>
                <div class="task-check"><div class="checkbox" id="check_dinner" onclick="toggleLifeHabit('dinner')"></div><span>åƒæ™šé¤</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+5åˆ†</span></div>
                <div class="task-check"><div class="checkbox" id="check_shower" onclick="toggleLifeHabit('shower')"></div><span>æ™šä¸Šæ´—æ¾¡</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+10åˆ†</span></div>
            </div>
            
            <div class="card"><div class="card-title">ğŸ“ ä»Šæ—¥è®°å½•</div>
                <div class="log-input-group"><label class="log-label">â° èµ·åºŠæ—¶é—´</label><div class="time-input-group"><div style="flex:1"><input type="number" class="time-input" id="wakeHour" placeholder="0" min="0" max="23"><div class="time-label">æ—¶</div></div><span class="time-separator">:</span><div style="flex:1"><input type="number" class="time-input" id="wakeMinute" placeholder="0" min="0" max="59"><div class="time-label">åˆ†</div></div></div></div>
                <div class="log-input-group"><label class="log-label">ğŸŒ™ ç¡è§‰æ—¶é—´</label><div class="time-input-group"><div style="flex:1"><input type="number" class="time-input" id="sleepHour" placeholder="0" min="0" max="23"><div class="time-label">æ—¶</div></div><span class="time-separator">:</span><div style="flex:1"><input type="number" class="time-input" id="sleepMinute" placeholder="0" min="0" max="59"><div class="time-label">åˆ†</div></div></div></div>
                <div class="log-input-group"><label class="log-label">ğŸ“š å­¦ä¹ æ—¶é•¿</label><div class="rating-selector" id="studyHours"><button class="rating-btn" data-value="0">0</button><button class="rating-btn" data-value="1">1</button><button class="rating-btn" data-value="2">2</button><button class="rating-btn" data-value="3">3</button><button class="rating-btn" data-value="4">4</button><button class="rating-btn" data-value="5">5</button><button class="rating-btn" data-value="6">6+</button></div></div>
                <div class="log-input-group"><label class="log-label">ğŸ’« çŠ¶æ€è¯„åˆ†</label><div class="rating-selector" id="statusRating"><button class="rating-btn" data-value="1">1</button><button class="rating-btn" data-value="2">2</button><button class="rating-btn" data-value="3">3</button><button class="rating-btn" data-value="4">4</button><button class="rating-btn" data-value="5">5</button><button class="rating-btn" data-value="6">6</button><button class="rating-btn" data-value="7">7</button><button class="rating-btn" data-value="8">8</button><button class="rating-btn" data-value="9">9</button><button class="rating-btn" data-value="10">10</button></div></div>
                <div class="log-input-group"><label class="log-label">ğŸ’° ä»Šæ—¥æ”¶å…¥</label><input type="number" class="log-input" id="dailyIncome" placeholder="0"></div>
                <div class="log-input-group"><label class="log-label">ğŸ® å¨±ä¹æ”¾æ¾ (10åˆ†)</label><div class="rating-selector" id="entertainmentTime"><button class="rating-btn" data-value="0">0</button><button class="rating-btn" data-value="30">30åˆ†</button><button class="rating-btn" data-value="60">1æ—¶</button><button class="rating-btn" data-value="90">1.5æ—¶</button><button class="rating-btn" data-value="120">2æ—¶+</button></div></div>
                <div class="log-input-group"><label class="log-label">âœï¸ ä¸€å¥è¯</label><input type="text" class="log-input" id="dailySummary" placeholder="ä»Šå¤©..."></div>
                <button class="save-btn" onclick="saveDailyLog()">ğŸ„ ä¿å­˜è®°å½• +20EXP ğŸ</button>
            </div>
            <div class="card"><div class="card-title">âœ… æ¯æ—¥å°ä»»åŠ¡</div><div id="dailyTasks"></div></div>
        </div>
        
        <div class="section" id="tasks">
            <div class="card"><div class="card-title">ğŸ“‹ å½“å‰ç« èŠ‚</div><div id="currentChapter"></div></div>
            <div class="card"><div class="card-title">ğŸ¯ ä¸»çº¿ä»»åŠ¡</div><div id="mainTasks"></div></div>
            <div class="card"><div class="card-title">ğŸ“Œ æ”¯çº¿ä»»åŠ¡</div><div id="sideTasks"></div></div>
        </div>
        
        <div class="section" id="equipment">
            <div class="card">
                <div class="card-title">ğŸ’ è£…å¤‡æ </div>
                <div class="equipment-grid">
                    <div class="equipment-slot" onclick="openEquipmentSlot('weapon')">
                        <div class="slot-icon">âš”ï¸</div>
                        <div class="slot-name">ä¸»æ­¦å™¨</div>
                        <div class="slot-item" id="slot_weapon">é¡¶é…ç”µè„‘</div>
                        <div class="slot-rarity ssr">SSR</div>
                    </div>
                    <div class="equipment-slot" onclick="openEquipmentSlot('armor')">
                        <div class="slot-icon">ğŸ›¡ï¸</div>
                        <div class="slot-name">æŠ¤ç”²</div>
                        <div class="slot-item empty" id="slot_armor">ç©º</div>
                    </div>
                    <div class="equipment-slot" onclick="openEquipmentSlot('accessory1')">
                        <div class="slot-icon">ğŸ’</div>
                        <div class="slot-name">é¥°å“1</div>
                        <div class="slot-item empty" id="slot_accessory1">ç©º</div>
                    </div>
                    <div class="equipment-slot" onclick="openEquipmentSlot('accessory2')">
                        <div class="slot-icon">ğŸ“¿</div>
                        <div class="slot-name">é¥°å“2</div>
                        <div class="slot-item empty" id="slot_accessory2">ç©º</div>
                    </div>
                    <div class="equipment-slot" onclick="openEquipmentSlot('tool1')">
                        <div class="slot-icon">ğŸ”§</div>
                        <div class="slot-name">å·¥å…·1</div>
                        <div class="slot-item" id="slot_tool1">AIå·¥å…·</div>
                        <div class="slot-rarity ssr">SSR</div>
                    </div>
                    <div class="equipment-slot" onclick="openEquipmentSlot('tool2')">
                        <div class="slot-icon">ğŸ”¨</div>
                        <div class="slot-name">å·¥å…·2</div>
                        <div class="slot-item empty" id="slot_tool2">ç©º</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“¦ è£…å¤‡åº“å­˜</div>
                <div id="equipmentInventory"></div>
                <button class="save-btn" onclick="showAddEquipment()" style="margin-top:15px">â• è‡ªå®šä¹‰è£…å¤‡</button>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ’ª è£…å¤‡åŠ æˆ</div>
                <div id="equipmentBonus"></div>
            </div>
        </div>
        
        <div class="section" id="social">
            <div class="card"><div class="card-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ å®¶äºº</div><div id="familyList"></div></div>
            <div class="card"><div class="card-title">ğŸ’¬ ç¤¾ç¾¤</div><div id="communityList"></div><button class="save-btn" onclick="addCommunity()" style="margin-top:15px">â• æ·»åŠ </button></div>
            <div class="card"><div class="card-title">ğŸ¤ æ–°æœ‹å‹</div><div id="newFriendsList"></div><button class="save-btn" onclick="addFriend()" style="margin-top:15px">â• æ·»åŠ </button></div>
        </div>
        
        <div class="section" id="achievements">
            <div class="card"><div class="card-title">ğŸ† æˆå°±è¿›åº¦</div><div id="achievementProgress"></div></div>
            <div class="card"><div class="card-title">ğŸ“‹ å…¨éƒ¨æˆå°±</div><div id="allAchievements"></div></div>
        </div>
        
        <div class="section" id="history">
            <div class="card"><div class="card-title">ğŸ“ˆ ç»Ÿè®¡</div><div class="history-stats"><div class="history-stat"><div class="history-stat-value" id="totalDays">0</div><div>å¤©æ•°</div></div><div class="history-stat"><div class="history-stat-value" id="totalStudy">0</div><div>å­¦ä¹ </div></div><div class="history-stat"><div class="history-stat-value" id="totalIncome">0</div><div>æ”¶å…¥</div></div></div></div>
            <div class="card"><div class="card-title">ğŸ“… è®°å½•</div><div id="historyList"></div></div>
        </div>
        
        <div class="section" id="boss">
            <div class="quote-box">"ä½ è¿™ä¸æ˜¯ç«™çš„æŒºå¥½çš„å—!!ä¸ºä»€ä¹ˆè¦å›æ¥!!"<div class="quote-author">â€”â€”é¦–é•¿</div></div>
            
            <div class="card">
                <div class="card-title">ğŸ‘¹ Bosså›¾é‰´ (20ä¸ª)</div>
                <div id="bossLibrary"></div>
            </div>
            
            <div class="card">
                <div class="card-title">âš”ï¸ æˆ˜æ–—è®°å½•</div>
                <div id="bossLog"></div>
                <button class="save-btn" onclick="addBossEncounter()">âš”ï¸ è®°å½•æˆ˜æ–—</button>
            </div>
        </div>
        
        <div class="section" id="finance">
            <div class="card">
                <div class="card-title">ğŸ’° å½“å‰ä½™é¢</div>
                <div class="money-display">
                    <div class="money-amount" id="currentMoney">Â¥0.00</div>
                    <div class="money-label">æ€»èµ„äº§</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“ è®°å½•æ”¶æ”¯</div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ’µ é‡‘é¢</label>
                    <input type="number" class="log-input" id="transactionAmount" placeholder="0.00" step="0.01">
                </div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ“¦ ç‰©å“åç§°</label>
                    <input type="text" class="log-input" id="transactionItem" placeholder="ä¾‹å¦‚ï¼šæœºæ¢°é”®ç›˜ã€è¯¾ç¨‹ã€ç”µå½±ç¥¨">
                </div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ“‹ ç±»å‹</label>
                    <div class="rating-selector">
                        <button class="rating-btn" data-value="income" style="width:auto; padding:10px 20px">æ”¶å…¥</button>
                        <button class="rating-btn" data-value="expense" style="width:auto; padding:10px 20px">æ”¯å‡º</button>
                    </div>
                </div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ·ï¸ ç±»åˆ«</label>
                    <div class="rating-selector" id="categorySelector">
                        <button class="rating-btn" data-value="food">ğŸ”é¥®é£Ÿ</button>
                        <button class="rating-btn" data-value="learning">ğŸ“šå­¦ä¹ </button>
                        <button class="rating-btn" data-value="entertainment">ğŸ®å¨±ä¹</button>
                        <button class="rating-btn" data-value="clothing">ğŸ‘•æœé¥°</button>
                        <button class="rating-btn" data-value="electronics">ğŸ’»ç”µå­</button>
                        <button class="rating-btn" data-value="life">ğŸ ç”Ÿæ´»</button>
                        <button class="rating-btn" data-value="health">ğŸ’Šå¥åº·</button>
                        <button class="rating-btn" data-value="other">ğŸ’°å…¶ä»–</button>
                    </div>
                </div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ›’ å¹³å°</label>
                    <div class="rating-selector" id="platformSelector">
                        <button class="rating-btn" data-value="taobao">æ·˜å®</button>
                        <button class="rating-btn" data-value="jd">äº¬ä¸œ</button>
                        <button class="rating-btn" data-value="pdd">æ‹¼å¤šå¤š</button>
                        <button class="rating-btn" data-value="takeout">å¤–å–</button>
                        <button class="rating-btn" data-value="offline">çº¿ä¸‹</button>
                        <button class="rating-btn" data-value="other">å…¶ä»–</button>
                    </div>
                </div>
                <div class="log-input-group">
                    <label class="log-label">âš ï¸ å¿…è¦æ€§</label>
                    <div class="rating-selector" id="necessitySelector">
                        <button class="rating-btn" data-value="must">âœ…å¿…éœ€å“</button>
                        <button class="rating-btn" data-value="want">âš ï¸æƒ³è¦çš„</button>
                        <button class="rating-btn" data-value="impulse">âŒå†²åŠ¨æ¶ˆè´¹</button>
                    </div>
                </div>
                <div class="log-input-group">
                    <label class="log-label">âœï¸ å¤‡æ³¨</label>
                    <input type="text" class="log-input" id="transactionNote" placeholder="å¤‡æ³¨ä¿¡æ¯">
                </div>
                <button class="save-btn" onclick="addTransaction()">ğŸ’° è®°å½•</button>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“Š æ”¶æ”¯æ˜ç»†</div>
                <div id="transactionsList"></div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“ˆ è´¢åŠ¡ç»Ÿè®¡</div>
                <div class="history-stats">
                    <div class="history-stat">
                        <div class="history-stat-value" style="color:#2ecc71" id="totalIncomeDisplay">Â¥0</div>
                        <div>æ€»æ”¶å…¥</div>
                    </div>
                    <div class="history-stat">
                        <div class="history-stat-value" style="color:#e74c3c" id="totalExpenseDisplay">Â¥0</div>
                        <div>æ€»æ”¯å‡º</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section" id="settings">
            <div class="card">
                <div class="card-title">âš™ï¸ åŸºç¡€è®¾ç½®</div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ’° åˆå§‹é‡‘é’±</label>
                    <input type="number" class="log-input" id="initialMoney" placeholder="0.00" step="0.01">
                    <button class="save-btn" onclick="setInitialMoney()" style="margin-top:10px">è®¾ç½®</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ“ è‡ªå®šä¹‰ç¬”è®°</div>
                <div class="log-input-group">
                    <label class="log-label">âœï¸ æ ‡é¢˜</label>
                    <input type="text" class="log-input" id="noteTitle" placeholder="ç¬”è®°æ ‡é¢˜">
                </div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ“„ å†…å®¹</label>
                    <textarea class="log-input" id="noteContent" placeholder="è®°å½•é‡è¦çš„äº‹æƒ…..." rows="5"></textarea>
                </div>
                <button class="save-btn" onclick="addNote()">ğŸ“ ä¿å­˜ç¬”è®°</button>
                <div id="notesList" style="margin-top:20px"></div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ¯ è‡ªå®šä¹‰ç›®æ ‡</div>
                <div class="log-input-group">
                    <label class="log-label">ğŸ¯ ç›®æ ‡å†…å®¹</label>
                    <input type="text" class="log-input" id="goalInput" placeholder="ä¾‹å¦‚ï¼šæ¯å¤©å­¦ä¹ 2å°æ—¶">
                </div>
                <button class="save-btn" onclick="addGoal()">â• æ·»åŠ ç›®æ ‡</button>
                <div id="goalsList" style="margin-top:20px"></div>
            </div>
            
            <div class="card">
                <div class="card-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
                <button class="save-btn" onclick="exportData()" style="margin-bottom:10px">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                <button class="save-btn" onclick="importData()" style="margin-bottom:10px">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                <button class="save-btn" onclick="resetData()" style="background:linear-gradient(135deg, #e74c3c, #c0392b)">ğŸ”„ é‡ç½®æ•°æ®</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modal"><div class="modal-content"><div class="modal-icon" id="modalIcon">ğŸ‰</div><div class="modal-title" id="modalTitle">æˆåŠŸ!</div><div class="modal-desc" id="modalDesc"></div><button class="modal-btn" onclick="closeModal()">ğŸ„ å¥½çš„!</button></div></div>
    <div class="fab" onclick="quickLog()">ğŸ“</div>
    
    <!-- è®°å½•è¯¦æƒ…Modal -->
    <div id="logDetailModal" class="modal" style="display:none">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header">
                <h2 id="logDetailTitle">Day 1 è¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeLogDetail()">Ã—</button>
            </div>
            <div class="modal-body" id="logDetailBody"></div>
        </div>
    </div>
    
    <!-- æœ‹å‹ç¼–è¾‘Modal -->
    <div id="friendEditModal" class="modal" style="display:none">
        <div class="modal-content" style="max-width:500px">
            <div class="modal-header">
                <h2>ç¼–è¾‘æœ‹å‹ä¿¡æ¯</h2>
                <button class="modal-close" onclick="closeFriendEdit()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editFriendIndex">
                <div class="log-input-group">
                    <label class="log-label">å§“å</label>
                    <input type="text" class="log-input" id="friendName" placeholder="è¯·è¾“å…¥å§“å">
                </div>
                <div class="log-input-group">
                    <label class="log-label">å¾®ä¿¡å·</label>
                    <input type="text" class="log-input" id="friendWechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
                </div>
                <div class="log-input-group">
                    <label class="log-label">æ‰‹æœºå·</label>
                    <input type="text" class="log-input" id="friendPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                </div>
                <div class="log-input-group">
                    <label class="log-label">æ€§æ ¼æ ‡ç­¾</label>
                    <input type="text" class="log-input" id="friendPersonality" placeholder="å¦‚: çƒ­æƒ…, å¹½é»˜, é è°±">
                </div>
                <div class="log-input-group">
                    <label class="log-label">çˆ±å¥½</label>
                    <input type="text" class="log-input" id="friendHobbies" placeholder="å¦‚: ç¯®çƒ, æ¸¸æˆ, æ‘„å½±">
                </div>
                <div class="log-input-group">
                    <label class="log-label">å¤‡æ³¨</label>
                    <textarea class="log-input" id="friendNotes" placeholder="å¤‡æ³¨ä¿¡æ¯" rows="3"></textarea>
                </div>
                <div class="log-input-group">
                    <label class="log-label">äº²å¯†åº¦</label>
                    <input type="range" id="friendIntimacy" min="0" max="100" value="50" oninput="document.getElementById('intimacyValue').textContent=this.value">
                    <div style="text-align:center; margin-top:5px"><span id="intimacyValue">50</span>/100</div>
                </div>
                <button class="save-btn" onclick="saveFriendEdit()">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- Bossè¯¦æƒ…Modal -->
    <div id="bossDetailModal" class="modal" style="display:none">
        <div class="modal-content" style="max-width:500px">
            <div class="modal-header">
                <h2 id="bossDetailTitle">Bossè¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeBossDetail()">Ã—</button>
            </div>
            <div class="modal-body" id="bossDetailBody"></div>
        </div>
    </div>
    
    <!-- è£…å¤‡æ§½é€‰æ‹©Modal -->
    <div id="equipSlotModal" class="modal" style="display:none">
        <div class="modal-content" style="max-width:400px">
            <div class="modal-header">
                <h2 id="equipSlotTitle">é€‰æ‹©è£…å¤‡</h2>
                <button class="modal-close" onclick="closeEquipSlot()">Ã—</button>
            </div>
            <div class="modal-body" id="equipSlotBody"></div>
        </div>
    </div>

    <script>
        let isPlaying=false;const music=document.getElementById('bgMusic'),musicBtn=document.getElementById('musicBtn');
        function toggleMusic(){if(isPlaying){music.pause();musicBtn.textContent='ğŸ”‡';musicBtn.classList.remove('playing');}else{music.play().catch(e=>console.log(''));musicBtn.textContent='ğŸµ';musicBtn.classList.add('playing');}isPlaying=!isPlaying;}
        
        // ==================== v4.0 å¸¸é‡å®šä¹‰ ====================
        const RANKS=[
            // æ··å­é»‘é“ (Iron) - Lv.1-3
            {name:'é»‘é“III',tier:'æ··å­é»‘é“',minLevel:1,img:'rank_iron.png',romanNum:'III',color:'#4A4A4A',glow:'rgba(138,43,43,0.5)'},
            {name:'é»‘é“II',tier:'æ··å­é»‘é“',minLevel:2,img:'rank_iron.png',romanNum:'II',color:'#5A4A4A',glow:'rgba(138,43,43,0.6)'},
            {name:'é»‘é“I',tier:'æ··å­é»‘é“',minLevel:3,img:'rank_iron.png',romanNum:'I',color:'#6A4A4A',glow:'rgba(138,43,43,0.7)'},
            
            // åŠªåŠ›é»„é“œ (Bronze) - Lv.4-7
            {name:'é»„é“œIV',tier:'åŠªåŠ›é»„é“œ',minLevel:4,img:'rank_bronze.png',romanNum:'IV',color:'#CD7F32',glow:'rgba(205,127,50,0.5)'},
            {name:'é»„é“œIII',tier:'åŠªåŠ›é»„é“œ',minLevel:5,img:'rank_bronze.png',romanNum:'III',color:'#D68942',glow:'rgba(205,127,50,0.6)'},
            {name:'é»„é“œII',tier:'åŠªåŠ›é»„é“œ',minLevel:6,img:'rank_bronze.png',romanNum:'II',color:'#E09952',glow:'rgba(205,127,50,0.7)'},
            {name:'é»„é“œI',tier:'åŠªåŠ›é»„é“œ',minLevel:7,img:'rank_bronze.png',romanNum:'I',color:'#EAA962',glow:'rgba(205,127,50,0.8)'},
            
            // åˆç«‹ç™½é“¶ (Silver) - Lv.8-11
            {name:'ç™½é“¶IV',tier:'åˆç«‹ç™½é“¶',minLevel:8,img:'rank_silver.png',romanNum:'IV',color:'#C0C0C0',glow:'rgba(192,192,192,0.5)'},
            {name:'ç™½é“¶III',tier:'åˆç«‹ç™½é“¶',minLevel:9,img:'rank_silver.png',romanNum:'III',color:'#CACACA',glow:'rgba(192,192,192,0.6)'},
            {name:'ç™½é“¶II',tier:'åˆç«‹ç™½é“¶',minLevel:10,img:'rank_silver.png',romanNum:'II',color:'#D4D4D4',glow:'rgba(192,192,192,0.7)'},
            {name:'ç™½é“¶I',tier:'åˆç«‹ç™½é“¶',minLevel:11,img:'rank_silver.png',romanNum:'I',color:'#DEDEDE',glow:'rgba(192,192,192,0.8)'},
            
            // ç«‹è¶³é»„é‡‘ (Gold) - Lv.12-15
            {name:'é»„é‡‘IV',tier:'ç«‹è¶³é»„é‡‘',minLevel:12,img:'rank_gold.png',romanNum:'IV',color:'#FFD700',glow:'rgba(255,215,0,0.5)'},
            {name:'é»„é‡‘III',tier:'ç«‹è¶³é»„é‡‘',minLevel:13,img:'rank_gold.png',romanNum:'III',color:'#FFDD33',glow:'rgba(255,215,0,0.6)'},
            {name:'é»„é‡‘II',tier:'ç«‹è¶³é»„é‡‘',minLevel:14,img:'rank_gold.png',romanNum:'II',color:'#FFE566',glow:'rgba(255,215,0,0.7)'},
            {name:'é»„é‡‘I',tier:'ç«‹è¶³é»„é‡‘',minLevel:15,img:'rank_gold.png',romanNum:'I',color:'#FFED99',glow:'rgba(255,215,0,0.8)'},
            
            // è¿›æ­¥é“‚é‡‘ (Platinum) - Lv.16-19
            {name:'é“‚é‡‘IV',tier:'è¿›æ­¥é“‚é‡‘',minLevel:16,img:'rank_platinum.png',romanNum:'IV',color:'#4ECDC4',glow:'rgba(78,205,196,0.5)'},
            {name:'é“‚é‡‘III',tier:'è¿›æ­¥é“‚é‡‘',minLevel:17,img:'rank_platinum.png',romanNum:'III',color:'#5ED7CE',glow:'rgba(78,205,196,0.6)'},
            {name:'é“‚é‡‘II',tier:'è¿›æ­¥é“‚é‡‘',minLevel:18,img:'rank_platinum.png',romanNum:'II',color:'#6EE1D8',glow:'rgba(78,205,196,0.7)'},
            {name:'é“‚é‡‘I',tier:'è¿›æ­¥é“‚é‡‘',minLevel:19,img:'rank_platinum.png',romanNum:'I',color:'#7EEBE2',glow:'rgba(78,205,196,0.8)'},
            
            // è‡ªè¶³é’»çŸ³ (Diamond) - Lv.20-23
            {name:'é’»çŸ³IV',tier:'è‡ªè¶³é’»çŸ³',minLevel:20,img:'rank_diamond.png',romanNum:'IV',color:'#B9F2FF',glow:'rgba(185,242,255,0.5)'},
            {name:'é’»çŸ³III',tier:'è‡ªè¶³é’»çŸ³',minLevel:21,img:'rank_diamond.png',romanNum:'III',color:'#C3F4FF',glow:'rgba(185,242,255,0.6)'},
            {name:'é’»çŸ³II',tier:'è‡ªè¶³é’»çŸ³',minLevel:22,img:'rank_diamond.png',romanNum:'II',color:'#CDF6FF',glow:'rgba(185,242,255,0.7)'},
            {name:'é’»çŸ³I',tier:'è‡ªè¶³é’»çŸ³',minLevel:23,img:'rank_diamond.png',romanNum:'I',color:'#D7F8FF',glow:'rgba(185,242,255,0.8)'},
            
            // èµ·è‰²å¤§å¸ˆ (Master) - Lv.24-26
            {name:'å¤§å¸ˆIII',tier:'èµ·è‰²å¤§å¸ˆ',minLevel:24,img:'rank_master.png',romanNum:'III',color:'#E066FF',glow:'rgba(224,102,255,0.6)'},
            {name:'å¤§å¸ˆII',tier:'èµ·è‰²å¤§å¸ˆ',minLevel:25,img:'rank_master.png',romanNum:'II',color:'#E680FF',glow:'rgba(224,102,255,0.7)'},
            {name:'å¤§å¸ˆI',tier:'èµ·è‰²å¤§å¸ˆ',minLevel:26,img:'rank_master.png',romanNum:'I',color:'#EC99FF',glow:'rgba(224,102,255,0.8)'},
            
            // æœˆä¸‡å®—å¸ˆ (Grandmaster) - Lv.27-29
            {name:'å®—å¸ˆIII',tier:'æœˆä¸‡å®—å¸ˆ',minLevel:27,img:'rank_grandmaster.png',romanNum:'III',color:'#FF4500',glow:'rgba(255,69,0,0.6)'},
            {name:'å®—å¸ˆII',tier:'æœˆä¸‡å®—å¸ˆ',minLevel:28,img:'rank_grandmaster.png',romanNum:'II',color:'#FF5520',glow:'rgba(255,69,0,0.7)'},
            {name:'å®—å¸ˆI',tier:'æœˆä¸‡å®—å¸ˆ',minLevel:29,img:'rank_grandmaster.png',romanNum:'I',color:'#FF6540',glow:'rgba(255,69,0,0.8)'},
            
            // ä¹è½¬ç‹è€… (Challenger) - Lv.30
            {name:'ç‹è€…â˜…â˜…â˜…',tier:'ä¹è½¬ç‹è€…',minLevel:30,img:'rank_challenger.png',romanNum:'',color:'#FFD700',glow:'rgba(255,215,0,1)',special:true}
        ];
        
        // v5.0 å®ç®±å¥–åŠ±ç³»ç»Ÿ
        const CHEST_REWARDS={
            normal:{ // æ™®é€šå®ç®± (60+æ´»è·ƒåº¦)
                virtual:[
                    {type:'exp',amount:50,weight:25,desc:'+50ç»éªŒ'},
                    {type:'money',amount:30,weight:15,desc:'+30é‡‘å¸'}
                ],
                entertainment:[
                    {type:'cinema',value:30,weight:15,desc:'çœ‹1éƒ¨ç”µå½±(30å…ƒ)'},
                    {type:'game',value:0,weight:10,desc:'ç©1å°æ—¶æ¸¸æˆ(æ— è´Ÿç½ªæ„Ÿ)'},
                    {type:'food',value:50,weight:10,desc:'åƒ1é¡¿å¥½åƒçš„(50å…ƒ)'},
                    {type:'drink',value:20,weight:10,desc:'ä¹°1æ¯å–œæ¬¢çš„é¥®å“(20å…ƒ)'}
                ],
                learning:[
                    {type:'book',value:50,weight:10,desc:'ä¹°1æœ¬æƒ³çœ‹çš„ä¹¦(50å…ƒ)'},
                    {type:'tool',value:100,weight:5,desc:'ä¹°1ä¸ªå­¦ä¹ å·¥å…·(100å…ƒ)'}
                ],
                equipment:[
                    {type:'fragment',weight:5,desc:'è£…å¤‡ç¢ç‰‡Ã—1'}
                ]
            },
            fine:{ // ç²¾è‰¯å®ç®± (80+æ´»è·ƒåº¦)
                virtual:[
                    {type:'exp',amount:100,weight:20,desc:'+100ç»éªŒ'},
                    {type:'money',amount:60,weight:10,desc:'+60é‡‘å¸'}
                ],
                entertainment:[
                    {type:'cinema_meal',value:150,weight:15,desc:'å‘¨æœ«çœ‹ç”µå½±+åƒé¥­(150å…ƒ)'},
                    {type:'game_buy',value:200,weight:10,desc:'ä¹°1ä¸ªæƒ³è¦çš„æ¸¸æˆ(200å…ƒ)'},
                    {type:'ktv',value:100,weight:10,desc:'KTVå”±æ­Œ1æ¬¡(100å…ƒ)'},
                    {type:'script',value:150,weight:10,desc:'å‰§æœ¬æ€1æ¬¡(150å…ƒ)'},
                    {type:'escape',value:150,weight:5,desc:'å¯†å®¤é€ƒè„±1æ¬¡(150å…ƒ)'}
                ],
                learning:[
                    {type:'course',value:300,weight:10,desc:'ä¹°è¯¾ç¨‹(300å…ƒ)'},
                    {type:'equipment',value:200,weight:5,desc:'ä¹°è£…å¤‡(200å…ƒ)'}
                ],
                equipment:[
                    {type:'SR',weight:5,desc:'SRè£…å¤‡Ã—1'}
                ]
            },
            rare:{ // ç¨€æœ‰å®ç®± (95+æ´»è·ƒåº¦)
                virtual:[
                    {type:'exp',amount:200,weight:15,desc:'+200ç»éªŒ'},
                    {type:'money',amount:100,weight:5,desc:'+100é‡‘å¸'}
                ],
                entertainment:[
                    {type:'travel',value:500,weight:20,desc:'å‘¨æœ«çŸ­é€”æ—…è¡Œ(500å…ƒ)'},
                    {type:'park',value:300,weight:10,desc:'æ¸¸ä¹åœº/æµ·æ´‹é¦†(300å…ƒ)'},
                    {type:'restaurant',value:400,weight:10,desc:'é«˜çº§é¤å…1æ¬¡(400å…ƒ)'},
                    {type:'spa',value:300,weight:10,desc:'æŒ‰æ‘©/SPAæ”¾æ¾(300å…ƒ)'},
                    {type:'clothes',value:500,weight:10,desc:'ä¹°å¿ƒä»ªçš„è¡£æœ(500å…ƒ)'},
                    {type:'gadget',value:500,weight:10,desc:'ç”µå­äº§å“é…ä»¶(500å…ƒ)'}
                ],
                learning:[
                    {type:'course_pro',value:600,weight:10,desc:'ä¹°é«˜çº§è¯¾ç¨‹(600å…ƒ)'},
                    {type:'equipment_pro',value:600,weight:5,desc:'å¥½è£…å¤‡å‡çº§(600å…ƒ)'}
                ],
                equipment:[
                    {type:'SSR',weight:10,desc:'SSRè£…å¤‡Ã—1'}
                ]
            },
            epic:{ // å²è¯—å®ç®± (è¿ç»­7å¤©80+)
                virtual:[
                    {type:'exp',amount:500,weight:10,desc:'+500ç»éªŒ'}
                ],
                entertainment:[
                    {type:'travel3d',value:1500,weight:30,desc:'3å¤©2å¤œæ—…è¡Œ(1500å…ƒ)'},
                    {type:'dream_item',value:1000,weight:20,desc:'ä¹°å¿ƒå¿ƒå¿µå¿µçš„ä¸œè¥¿(1000å…ƒ)'},
                    {type:'concert',value:800,weight:15,desc:'æ¼”å”±ä¼š/éŸ³ä¹èŠ‚é—¨ç¥¨(800å…ƒ)'},
                    {type:'fine_dining',value:600,weight:10,desc:'é«˜ç«¯é¤å…çº¦ä¼š(600å…ƒ)'},
                    {type:'theme_park',value:500,weight:5,desc:'ä¸»é¢˜ä¹å›­é€šç¥¨(500å…ƒ)'}
                ],
                learning:[
                    {type:'pro_equipment',value:1000,weight:5,desc:'ä¸“ä¸šè®¾å¤‡(1000å…ƒ)'},
                    {type:'long_course',value:1500,weight:3,desc:'é•¿æœŸè¯¾ç¨‹(1500å…ƒ)'}
                ],
                equipment:[
                    {type:'legend_fragment',weight:2,desc:'ä¼ è¯´è£…å¤‡ç¢ç‰‡Ã—3'}
                ]
            },
            legendary:{ // ä¼ è¯´å®ç®± (30å¤©ç‹è€…)
                entertainment:[
                    {type:'travel7d',value:5000,weight:40,desc:'7å¤©é•¿é€”æ—…è¡Œ(3000-5000å…ƒ)'},
                    {type:'big_dream',value:3000,weight:30,desc:'ä¹°æ¢¦æƒ³ä¸­çš„å¤§ä»¶(3000å…ƒ)'},
                    {type:'vip',value:2000,weight:20,desc:'VIPä½“éªŒå¥—é¤(2000å…ƒ)'},
                    {type:'extreme',value:2000,weight:10,desc:'æé™è¿åŠ¨ä½“éªŒ(è·³ä¼/æ½œæ°´,2000å…ƒ)'}
                ],
                equipment:[
                    {type:'legendary',weight:100,desc:'ä¼ è¯´è£…å¤‡Ã—1 + æ°¸ä¹…ç§°å·'}
                ]
            }
        };
        
        const BOSS_LIBRARY=[
            {id:'lazy_dragon',name:'æƒ°æ€§ä¹‹é¾™',icon:'ğŸ‰',diff:1,desc:'æ—©ä¸Šå†ç¡5åˆ†é’Ÿçš„è¯±æƒ‘',tips:'è®¾å®šé—¹é’Ÿæ”¾è¿œå¤„'},
            {id:'restart_demon',name:'é‡å¼€æ¶é­”',icon:'ğŸ‘¿',diff:3,desc:'é‡åˆ°ä¸å®Œç¾å°±æƒ³é‡å¼€',tips:'å®Œæˆæ¯”å®Œç¾é‡è¦'},
            {id:'forget_fog',name:'é—å¿˜ä¹‹é›¾',icon:'ğŸŒ«ï¸',diff:2,desc:'åœå‡ å¤©å°±å¿˜è®°è¿›åº¦',tips:'æ¯å¤©çœ‹æ˜¨å¤©çš„è®°å½•'},
            {id:'compare_giant',name:'æ¯”è¾ƒå·¨äºº',icon:'ğŸ‘¤',diff:2,desc:'æ€»æ˜¯å’Œåˆ«äººæ¯”è¾ƒ',tips:'åªå’Œæ˜¨å¤©çš„è‡ªå·±æ¯”'},
            {id:'comfort_trap',name:'èˆ’é€‚é™·é˜±',icon:'ğŸ›‹ï¸',diff:4,desc:'æœ‰é€€è·¯å°±ä¸åŠªåŠ›',tips:'è®°ä½é¦–é•¿çš„è¯'},
            {id:'night_demon',name:'å¤œçŒ«æ¶é­”',icon:'ğŸ¦‡',diff:2,desc:'æ·±å¤œä¸ç¡',tips:'23ç‚¹å‰å…³æ‰‹æœº'},
            {id:'phone_monster',name:'æ‰‹æœºæ€ªå…½',icon:'ğŸ“±',diff:3,desc:'æ— æ³•æ§åˆ¶åœ°åˆ·æ‰‹æœº',tips:'ç•ªèŒ„é’Ÿå·¥ä½œæ³•'},
            {id:'plastic_surgeon',name:'æ•´å®¹åŒ»ç”Ÿ',icon:'ğŸ’‰',diff:5,desc:'å¤–è²Œç„¦è™‘æƒ³æ•´å®¹',tips:'å·²æ•´5æ¬¡å¤Ÿäº†'},
            {id:'delete_devil',name:'åˆ é™¤é­”é¬¼',icon:'ğŸ—‘ï¸',diff:3,desc:'æƒ³åˆ é™¤è®°å½•',tips:'è¿‡å»æ˜¯æˆé•¿'},
            {id:'comparison_beast',name:'æ”€æ¯”çŒ›å…½',icon:'ğŸ¦',diff:2,desc:'çœ‹åˆ°åˆ«äººä¹Ÿæƒ³è¦',tips:'ä½ çš„è·¯è‡ªå·±èµ°'},
            {id:'instant_gratification',name:'å³åˆ»æ»¡è¶³å…½',icon:'ğŸ°',diff:4,desc:'æƒ³ç«‹åˆ»å¾—åˆ°ç»“æœ',tips:'30å¤©åå›å¤´çœ‹'},
            {id:'social_anxiety',name:'ç¤¾æå·¨å…½',icon:'ğŸ˜°',diff:3,desc:'ä¸æ•¢ç¤¾äº¤',tips:'å‹‡æ•¢è¿ˆå‡ºç¬¬ä¸€æ­¥'},
            {id:'violence_shadow',name:'æš´åŠ›é˜´å½±',icon:'ğŸ‘Š',diff:4,desc:'æš´åŠ›å€¾å‘',tips:'æ·±å‘¼å¸å†·é™5åˆ†é’Ÿ'},
            {id:'shame_demon',name:'ç¾è€»æ¶é­”',icon:'ğŸ™ˆ',diff:5,desc:'é€€å…µçš„ç¾è€»æ„Ÿ',tips:'å‘å‰çœ‹'},
            {id:'addiction_beast',name:'æˆç˜¾çŒ›å…½',icon:'ğŸ’Š',diff:5,desc:'è¯ç‰©å’Œæ€§ç˜¾',tips:'å»ºç«‹å¥åº·ä¹ æƒ¯'},
            {id:'debt_monster',name:'å€ºåŠ¡æ€ªå…½',icon:'ğŸ’³',diff:4,desc:'ä¿¡ç”¨ç ´äº§',tips:'å…ˆè¿˜å€ºå†æ¶ˆè´¹'},
            {id:'nightclub_shadow',name:'å¤œåœºå¹½çµ',icon:'ğŸ­',diff:3,desc:'å¤œåœºç»å†é˜´å½±',tips:'é‡æ–°å¼€å§‹'},
            {id:'hometown_call',name:'æ•…ä¹¡å¬å”¤',icon:'ğŸ ',diff:2,desc:'æƒ³å›æ­¦æ±‰ä¾èµ–',tips:'ä½ èƒ½è¡Œçš„'},
            {id:'imposter_syndrome',name:'å†’åé¡¶æ›¿æ€ª',icon:'ğŸ­',diff:3,desc:'è§‰å¾—è‡ªå·±ä¸é…',tips:'ä½ å€¼å¾—'},
            {id:'perfectionism',name:'å®Œç¾ä¸»ä¹‰é¾™',icon:'ğŸ‘‘',diff:4,desc:'å®Œç¾å¯¼è‡´æ— æ³•å¼€å§‹',tips:'60åˆ†å¤Ÿäº†'}
        ];
        const ACHIEVEMENTS={day1:{name:'æ–°çš„å¼€å§‹',desc:'è®°å½•ç¬¬ä¸€å¤©',reward:50,icon:'ğŸŒ±'},day7:{name:'åˆå¿ƒä¸æ”¹',desc:'è¿ç»­7å¤©',reward:100,icon:'ğŸ“'},day14:{name:'åšæŒä¸æ‡ˆ',desc:'è¿ç»­14å¤©',reward:150,icon:'ğŸ’ª'},day30:{name:'æœˆåº¦å† å†›',desc:'è¿ç»­30å¤©',reward:300,icon:'ğŸ†'},day60:{name:'ä¸å±ˆä¹‹å¿—',desc:'è¿ç»­60å¤©',reward:500,icon:'ğŸ”¥'},day90:{name:'ä¼ å¥‡ä¹‹è·¯',desc:'è¿ç»­90å¤©',reward:800,icon:'ğŸ‘‘'},study10:{name:'å­¦ä¹ å¯è’™',desc:'å­¦ä¹ 10å°æ—¶',reward:100,icon:'ğŸ“š'},study30:{name:'å‹¤å¥‹å¥½å­¦',desc:'å­¦ä¹ 30å°æ—¶',reward:200,icon:'âœï¸'},study50:{name:'å­¦éœ¸ä¹‹è·¯',desc:'å­¦ä¹ 50å°æ—¶',reward:300,icon:'ğŸ“'},study100:{name:'ç™¾å°æ—¶çªç ´',desc:'å­¦ä¹ 100å°æ—¶',reward:500,icon:'ğŸŒŸ'},study5day:{name:'å•æ—¥å­¦éœ¸',desc:'å•æ—¥å­¦ä¹ 5å°æ—¶',reward:150,icon:'âš¡'},income1:{name:'é¦–æ¡¶é‡‘',desc:'ç¬¬ä¸€ç¬”æ”¶å…¥',reward:80,icon:'ğŸ’°'},income500:{name:'å°å¯Œå³å®‰',desc:'ç´¯è®¡500å…ƒ',reward:100,icon:'ğŸ’µ'},income1000:{name:'åƒå…ƒé‡Œç¨‹ç¢‘',desc:'ç´¯è®¡1000å…ƒ',reward:200,icon:'ğŸ’´'},income3000:{name:'ä¸‰åƒè¿›é˜¶',desc:'ç´¯è®¡3000å…ƒ',reward:300,icon:'ğŸ’·'},income5000:{name:'äº”åƒçªç ´',desc:'ç´¯è®¡5000å…ƒ',reward:500,icon:'ğŸ’¶'},income10000:{name:'ä¸‡å…ƒæˆå°±',desc:'ç´¯è®¡10000å…ƒ',reward:1000,icon:'ğŸ‘‘'},income100day:{name:'å•æ—¥ç™¾å…ƒ',desc:'å•æ—¥100å…ƒ',reward:150,icon:'ğŸ¯'},debuff1:{name:'ç ´é™¤ç¬¬ä¸€é“æ·é”',desc:'æ¸…é™¤1ä¸ªDebuff',reward:100,icon:'ğŸ”“'},debuff3:{name:'ä¸‰é‡æ·é”ç ´é™¤',desc:'æ¸…é™¤3ä¸ª',reward:250,icon:'â›“ï¸'},debuff8:{name:'é‡è·è‡ªç”±',desc:'æ¸…é™¤æ‰€æœ‰',reward:800,icon:'ğŸ¦…'},boss1:{name:'åˆæ¬¡èƒœåˆ©',desc:'æˆ˜èƒœ1ä¸ªBoss',reward:100,icon:'âš”ï¸'},boss5:{name:'Bossæ€æ‰‹',desc:'æˆ˜èƒœ5ä¸ª',reward:300,icon:'ğŸ—¡ï¸'},boss10:{name:'Bossç»ˆç»“è€…',desc:'æˆ˜èƒœ10ä¸ª',reward:600,icon:'ğŸ¹'},bossAll:{name:'å…¨Bossåˆ¶éœ¸',desc:'æˆ˜èƒœæ‰€æœ‰',reward:1000,icon:'ğŸ‘‘'},friend1:{name:'ç ´å†°è¡ŒåŠ¨',desc:'ç»“è¯†1ä¸ªæœ‹å‹',reward:80,icon:'ğŸ¤'},friend3:{name:'ç¤¾äº¤æ–°æ˜Ÿ',desc:'ç»“è¯†3ä¸ª',reward:150,icon:'ğŸ‘¥'},friend10:{name:'äººè„‰å¹¿é˜”',desc:'ç»“è¯†10ä¸ª',reward:400,icon:'ğŸŒ'},community1:{name:'ç¤¾ç¾¤å½’å±',desc:'åŠ å…¥1ä¸ªç¤¾ç¾¤',reward:80,icon:'ğŸ’¬'},goal1:{name:'ç›®æ ‡è®¾å®šè€…',desc:'è®¾å®š1ä¸ªç›®æ ‡',reward:50,icon:'ğŸ¯'},goalComplete1:{name:'é¦–ä¸ªå®Œæˆ',desc:'å®Œæˆ1ä¸ª',reward:100,icon:'âœ…'},goalComplete3:{name:'æ‰§è¡ŒåŠ›åˆæ˜¾',desc:'å®Œæˆ3ä¸ª',reward:200,icon:'ğŸ’ª'},goalComplete10:{name:'ç›®æ ‡è¾¾äºº',desc:'å®Œæˆ10ä¸ª',reward:500,icon:'ğŸ†'},note1:{name:'é¦–ç¯‡ç¬”è®°',desc:'å†™1ç¯‡ç¬”è®°',reward:60,icon:'ğŸ“'},note10:{name:'ç¬”è®°è¾¾äºº',desc:'å†™10ç¯‡',reward:200,icon:'ğŸ“–'},attr_all60:{name:'å…¨èƒ½æˆ˜å£«',desc:'æ‰€æœ‰å±æ€§60+',reward:1000,icon:'ğŸŒŸ'},rank1:{name:'ç™½é“¶æˆ˜å£«',desc:'è¾¾åˆ°ç™½é“¶',reward:200,icon:'ğŸ¥ˆ'},rank2:{name:'é»„é‡‘å‹‡è€…',desc:'è¾¾åˆ°é»„é‡‘',reward:400,icon:'ğŸ¥‡'},rank3:{name:'é“‚é‡‘è‹±é›„',desc:'è¾¾åˆ°é“‚é‡‘',reward:600,icon:'ğŸ’'},rank4:{name:'é’»çŸ³å¤§å¸ˆ',desc:'è¾¾åˆ°é’»çŸ³',reward:800,icon:'ğŸ’ '},rank5:{name:'è¶…å‡¡å…¥åœ£',desc:'è¾¾åˆ°è¶…å‡¡',reward:1200,icon:'â­'},rank6:{name:'å®—å¸ˆä¹‹è·¯',desc:'è¾¾åˆ°å®—å¸ˆ',reward:1600,icon:'ğŸ”¥'},rank7:{name:'æœ€å¼ºç‹è€…',desc:'è¾¾åˆ°ç‹è€…',reward:2000,icon:'ğŸ‘‘'},chapter1:{name:'ç”Ÿå­˜æœŸå®Œæˆ',desc:'å®Œæˆç¬¬ä¸€ç« ',reward:500,icon:'ğŸŒ±'},chapter2:{name:'æ¢å¤æœŸå®Œæˆ',desc:'å®Œæˆç¬¬äºŒç« ',reward:800,icon:'ğŸŒ¿'},chapter3:{name:'å¯åŠ¨æœŸå®Œæˆ',desc:'å®Œæˆç¬¬ä¸‰ç« ',reward:1200,icon:'ğŸŒ³'},chapter4:{name:'è…¾é£æœŸå®Œæˆ',desc:'å®Œæˆç¬¬å››ç« ',reward:2000,icon:'ğŸš€'},kingReturn:{name:'ç‹è€…å½’æ¥',desc:'Lv.30å®Œæˆæ‰€æœ‰ä¸»çº¿',reward:5000,icon:'ğŸ‘‘'}};
        const EQUIPMENT_LIB={'é¡¶é…ç”µè„‘':{slot:'weapon',rarity:'SSR',effect:{æŠ€èƒ½:20,æ™ºåŠ›:15},icon:'ğŸ’»'},'AIå·¥å…·':{slot:'weapon',rarity:'SSR',effect:{æ™ºåŠ›:15,æŠ€èƒ½:10},icon:'ğŸ¤–'},'ChatGPT Plus':{slot:'weapon',rarity:'SSR',effect:{æ™ºåŠ›:20},icon:'ğŸ§ '},'Midjourney':{slot:'tool1',rarity:'SSR',effect:{é­…åŠ›:15},icon:'ğŸ¨'},'æœºæ¢°é”®ç›˜':{slot:'tool1',rarity:'SR',effect:{æŠ€èƒ½:10},icon:'âŒ¨ï¸'},'åŒæ˜¾ç¤ºå™¨':{slot:'tool2',rarity:'SR',effect:{æ™ºåŠ›:5},icon:'ğŸ–¥ï¸'},'é™å™ªè€³æœº':{slot:'accessory1',rarity:'SR',effect:{ç²¾ç¥:10},icon:'ğŸ§'},'äººä½“å·¥å­¦æ¤…':{slot:'armor',rarity:'SR',effect:{ä½“è´¨:10},icon:'ğŸª‘'},'ç¬”è®°æœ¬':{slot:'tool1',rarity:'R',effect:{æ™ºåŠ›:5},icon:'ğŸ““'},'å°ç¯':{slot:'accessory2',rarity:'R',effect:{ç²¾ç¥:5},icon:'ğŸ’¡'},'æ°´æ¯':{slot:'accessory1',rarity:'R',effect:{ä½“è´¨:3},icon:'ğŸ¥¤'},'é—¹é’Ÿ':{slot:'tool2',rarity:'R',effect:{æ„å¿—:5},icon:'â°'},'é¼ æ ‡':{slot:'tool1',rarity:'N',effect:{æŠ€èƒ½:3},icon:'ğŸ–±ï¸'},'æ‰‹æœº':{slot:'tool2',rarity:'N',effect:{ç¤¾äº¤:5},icon:'ğŸ“±'}};
        
        const defaultData={
            day:1,
            hp:60,
            mp:20,
            exp:0,
            level:1,
            levelExp:0,
            money:0,
            transactions:[],
            notes:[],
            goals:[],
            totalExpense:0,
            rank:0,
            rankPoints:0,
            buffs:{},
            equipment:{
                weapon:{name:'é¡¶é…ç”µè„‘',rarity:'SSR'},
                armor:null,
                accessory1:null,
                accessory2:null,
                tool1:{name:'AIå·¥å…·',rarity:'SSR'},
                tool2:null
            },
            equipmentInventory:[],
            achievementsUnlocked:[],
            bossDefeated:{},
            friendsDetailed:[],
            attributes:{
                ä½“è´¨:25,
                ç²¾ç¥:20,
                é­…åŠ›:40,
                æ™ºåŠ›:55,
                æ„å¿—:15,
                ç¤¾äº¤:30,
                è´¢å¯Œ:10,
                æŠ€èƒ½:15
            },
            debuffs:{
                'ä½œæ¯ç´Šä¹±':true,
                'è¯ç‰©é€‚åº”æœŸ':true,
                'åŠ¨åŠ›æ¯ç«­':true,
                'é‡å¼€æˆç˜¾':true,
                'åˆ é™¤å¼ºè¿«':true,
                'ä¿¡ç”¨ç ´äº§':true,
                'å¤–è²Œç„¦è™‘':true,
                'å¯„ç”ŸçŠ¶æ€':true
            },
            dailyLogs:[],
            achievements:{},
            communities:[],
            friends:[],
            family:[
                {name:'çˆ¶äº²',type:'å®¶äºº',intimacy:80,notes:'å—è½¦é›†å›¢ï¼Œå¾ˆçˆ±æˆ‘'},
                {name:'æ¯äº²',type:'å®¶äºº',intimacy:60,notes:'åœ¨å®¶ç…§é¡¾æˆ‘é•¿å¤§'}
            ],
            bossEncounters:[],
            totalStudyHours:0,
            totalIncome:0,
            consecutiveDays:0,
            lastLoginDate:'',
            dailyActiveScore:0,
            lifeHabits:{
                washFace:false,
                breakfast:false,
                lunch:false,
                dinner:false,
                shower:false
            },
            entertainmentLog:[],
            shoppingCart:[],
            chestInventory:[],
            loginRewards:{},
            tasks:{
                daily:{},
                main:[
                    // Lv.1 ä¸»çº¿
                    {id:'start_journey',name:'å¼€å§‹æ—…ç¨‹ï¼šè®°å½•ç¬¬ä¸€å¤©',level:1,progress:0,target:1,completed:false,reward:{exp:50,money:0},unlocked:true},
                    // Lv.2 ä¸»çº¿
                    {id:'consecutive3',name:'åšæŒ3å¤©ï¼šå»ºç«‹ä¹ æƒ¯',level:2,progress:0,target:3,completed:false,reward:{exp:80,money:0},unlocked:false},
                    // Lv.3 ä¸»çº¿
                    {id:'first_debuff',name:'æ¸…é™¤ç¬¬ä¸€ä¸ªDebuff',level:3,progress:0,target:1,completed:false,reward:{exp:100,money:0},unlocked:false},
                    // Lv.4 ä¸»çº¿
                    {id:'study10h',name:'ç´¯è®¡å­¦ä¹ 10å°æ—¶',level:4,progress:0,target:10,completed:false,reward:{exp:120,money:0},unlocked:false},
                    // Lv.5 ä¸»çº¿
                    {id:'consecutive7',name:'ä¸ƒæ—¥åšæŒï¼šè¿ç»­è®°å½•7å¤©',level:5,progress:0,target:7,completed:false,reward:{exp:200,money:50},unlocked:false},
                    // Lv.6 ä¸»çº¿
                    {id:'first_note',name:'å†™ä¸‹ç¬¬ä¸€ç¯‡åæ€ç¬”è®°',level:6,progress:0,target:1,completed:false,reward:{exp:100,money:0},unlocked:false},
                    // Lv.7 ä¸»çº¿
                    {id:'defeat_lazy',name:'æˆ˜èƒœæƒ°æ€§ä¹‹é¾™3æ¬¡',level:7,progress:0,target:3,completed:false,reward:{exp:150,money:0},unlocked:false},
                    // Lv.8 ä¸»çº¿
                    {id:'clear3debuffs',name:'æ¸…é™¤3ä¸ªDebuffï¼šæ‘†è„±è´Ÿé¢çŠ¶æ€',level:8,progress:0,target:3,completed:false,reward:{exp:250,money:100},unlocked:false},
                    // Lv.9 ä¸»çº¿
                    {id:'study30h',name:'ç´¯è®¡å­¦ä¹ 30å°æ—¶',level:9,progress:0,target:30,completed:false,reward:{exp:300,money:0},unlocked:false},
                    // Lv.10 ä¸»çº¿
                    {id:'chapter1_complete',name:'å®Œæˆç¬¬ä¸€ç« ï¼šç”Ÿå­˜æœŸ',level:10,progress:0,target:30,completed:false,reward:{exp:500,money:200},unlocked:false},
                    // Lv.11 ä¸»çº¿
                    {id:'income500',name:'ç´¯è®¡æ”¶å…¥500å…ƒ',level:11,progress:0,target:500,completed:false,reward:{exp:200,money:100},unlocked:false},
                    // Lv.12 ä¸»çº¿
                    {id:'set5goals',name:'è®¾å®š5ä¸ªäººç”Ÿç›®æ ‡',level:12,progress:0,target:5,completed:false,reward:{exp:150,money:0},unlocked:false},
                    // Lv.13 ä¸»çº¿
                    {id:'defeat_restart',name:'æˆ˜èƒœé‡å¼€æ¶é­”5æ¬¡',level:13,progress:0,target:5,completed:false,reward:{exp:300,money:0},unlocked:false},
                    // Lv.14 ä¸»çº¿
                    {id:'clear5debuffs',name:'æ¸…é™¤5ä¸ªDebuff',level:14,progress:0,target:5,completed:false,reward:{exp:400,money:150},unlocked:false},
                    // Lv.15 ä¸»çº¿
                    {id:'study60h',name:'ç´¯è®¡å­¦ä¹ 60å°æ—¶',level:15,progress:0,target:60,completed:false,reward:{exp:500,money:200},unlocked:false},
                    // Lv.16 ä¸»çº¿
                    {id:'income1000',name:'ç´¯è®¡æ”¶å…¥1000å…ƒ',level:16,progress:0,target:1000,completed:false,reward:{exp:400,money:200},unlocked:false},
                    // Lv.17 ä¸»çº¿
                    {id:'consecutive30',name:'è¿ç»­è®°å½•30å¤©',level:17,progress:0,target:30,completed:false,reward:{exp:600,money:300},unlocked:false},
                    // Lv.18 ä¸»çº¿
                    {id:'complete5goals',name:'å®Œæˆ5ä¸ªç›®æ ‡',level:18,progress:0,target:5,completed:false,reward:{exp:500,money:200},unlocked:false},
                    // Lv.19 ä¸»çº¿
                    {id:'clear_all_debuffs',name:'æ¸…é™¤æ‰€æœ‰Debuff',level:19,progress:0,target:8,completed:false,reward:{exp:800,money:500},unlocked:false},
                    // Lv.20 ä¸»çº¿
                    {id:'chapter2_complete',name:'å®Œæˆç¬¬äºŒç« ï¼šæ¢å¤æœŸ',level:20,progress:0,target:60,completed:false,reward:{exp:1000,money:500},unlocked:false},
                    // Lv.21 ä¸»çº¿
                    {id:'income3000',name:'ç´¯è®¡æ”¶å…¥3000å…ƒ',level:21,progress:0,target:3000,completed:false,reward:{exp:600,money:300},unlocked:false},
                    // Lv.22 ä¸»çº¿
                    {id:'study100h',name:'ç´¯è®¡å­¦ä¹ 100å°æ—¶',level:22,progress:0,target:100,completed:false,reward:{exp:700,money:0},unlocked:false},
                    // Lv.23 ä¸»çº¿
                    {id:'make_friend',name:'ç»“è¯†3ä¸ªæ–°æœ‹å‹',level:23,progress:0,target:3,completed:false,reward:{exp:500,money:0},unlocked:false},
                    // Lv.24 ä¸»çº¿
                    {id:'join_community',name:'åŠ å…¥2ä¸ªç¤¾ç¾¤',level:24,progress:0,target:2,completed:false,reward:{exp:400,money:0},unlocked:false},
                    // Lv.25 ä¸»çº¿
                    {id:'defeat_all_bosses',name:'æˆ˜èƒœæ‰€æœ‰Bosså„1æ¬¡',level:25,progress:0,target:5,completed:false,reward:{exp:1000,money:500},unlocked:false},
                    // Lv.26 ä¸»çº¿
                    {id:'income5000',name:'ç´¯è®¡æ”¶å…¥5000å…ƒ',level:26,progress:0,target:5000,completed:false,reward:{exp:800,money:500},unlocked:false},
                    // Lv.27 ä¸»çº¿
                    {id:'consecutive60',name:'è¿ç»­è®°å½•60å¤©',level:27,progress:0,target:60,completed:false,reward:{exp:1000,money:1000},unlocked:false},
                    // Lv.28 ä¸»çº¿
                    {id:'write10notes',name:'å†™ä¸‹10ç¯‡ç¬”è®°',level:28,progress:0,target:10,completed:false,reward:{exp:800,money:0},unlocked:false},
                    // Lv.29 ä¸»çº¿
                    {id:'study150h',name:'ç´¯è®¡å­¦ä¹ 150å°æ—¶',level:29,progress:0,target:150,completed:false,reward:{exp:1000,money:500},unlocked:false},
                    // Lv.30 ä¸»çº¿ï¼ˆç»ˆæç›®æ ‡ï¼‰
                    {id:'rebirth_complete',name:'é‡ç”Ÿå®Œæˆï¼šæœˆå…¥è¿‡ä¸‡',level:30,progress:0,target:10000,completed:false,reward:{exp:2000,money:2000},unlocked:false}
                ],
                side:[
                    // åŸºç¡€æ”¯çº¿
                    {id:'first_wake',name:'è®°å½•ç¬¬ä¸€æ¬¡èµ·åºŠæ—¶é—´',type:'åŸºç¡€',completed:false,reward:{exp:30}},
                    {id:'first_study',name:'è®°å½•ç¬¬ä¸€æ¬¡å­¦ä¹ ',type:'åŸºç¡€',completed:false,reward:{exp:30}},
                    {id:'first_income',name:'è®°å½•ç¬¬ä¸€ç¬”æ”¶å…¥',type:'åŸºç¡€',completed:false,reward:{exp:50}},
                    {id:'writeNote',name:'å†™ç¬¬ä¸€ç¯‡ç¬”è®°',type:'åŸºç¡€',completed:false,reward:{exp:50}},
                    {id:'setGoal',name:'è®¾å®šç¬¬ä¸€ä¸ªç›®æ ‡',type:'åŸºç¡€',completed:false,reward:{exp:30}},
                    {id:'addFriend',name:'è®°å½•ç¬¬ä¸€ä¸ªæ–°æœ‹å‹',type:'ç¤¾äº¤',completed:false,reward:{exp:50}},
                    {id:'defeatBoss',name:'æˆ˜èƒœç¬¬ä¸€ä¸ªBoss',type:'æˆ˜æ–—',completed:false,reward:{exp:100}},
                    {id:'join_first_community',name:'åŠ å…¥ç¬¬ä¸€ä¸ªç¤¾ç¾¤',type:'ç¤¾äº¤',completed:false,reward:{exp:50}},
                    
                    // ä¹ æƒ¯å…»æˆç³»åˆ—
                    {id:'early_bird',name:'è¿ç»­3å¤©æ—©èµ·ï¼ˆ7ç‚¹å‰ï¼‰',type:'ä¹ æƒ¯',completed:false,reward:{exp:100}},
                    {id:'no_stay_up',name:'è¿ç»­7å¤©ä¸ç†¬å¤œï¼ˆ23ç‚¹å‰ç¡ï¼‰',type:'ä¹ æƒ¯',completed:false,reward:{exp:150}},
                    {id:'daily_study',name:'è¿ç»­5å¤©å­¦ä¹ è¶…è¿‡2å°æ—¶',type:'ä¹ æƒ¯',completed:false,reward:{exp:120}},
                    {id:'keep_diary',name:'è¿ç»­10å¤©å†™æ—¥è®°æ€»ç»“',type:'ä¹ æƒ¯',completed:false,reward:{exp:200}},
                    
                    // Debuffæ¸…é™¤ç³»åˆ—
                    {id:'fix_sleep',name:'æ¸…é™¤"ä½œæ¯ç´Šä¹±"Debuff',type:'æˆé•¿',completed:false,reward:{exp:100}},
                    {id:'stop_restart',name:'æ¸…é™¤"é‡å¼€æˆç˜¾"Debuff',type:'æˆé•¿',completed:false,reward:{exp:150}},
                    {id:'stop_delete',name:'æ¸…é™¤"åˆ é™¤å¼ºè¿«"Debuff',type:'æˆé•¿',completed:false,reward:{exp:150}},
                    {id:'build_confidence',name:'æ¸…é™¤"å¤–è²Œç„¦è™‘"Debuff',type:'æˆé•¿',completed:false,reward:{exp:200}},
                    {id:'be_independent',name:'æ¸…é™¤"å¯„ç”ŸçŠ¶æ€"Debuff',type:'æˆé•¿',completed:false,reward:{exp:250}},
                    
                    // å­¦ä¹ æˆé•¿ç³»åˆ—
                    {id:'study_5h',name:'å•å¤©å­¦ä¹ 5å°æ—¶',type:'å­¦ä¹ ',completed:false,reward:{exp:80}},
                    {id:'study_milestone_20',name:'å­¦ä¹ é‡Œç¨‹ç¢‘ï¼š20å°æ—¶',type:'å­¦ä¹ ',completed:false,reward:{exp:100}},
                    {id:'study_milestone_50',name:'å­¦ä¹ é‡Œç¨‹ç¢‘ï¼š50å°æ—¶',type:'å­¦ä¹ ',completed:false,reward:{exp:200}},
                    {id:'study_milestone_100',name:'å­¦ä¹ é‡Œç¨‹ç¢‘ï¼š100å°æ—¶',type:'å­¦ä¹ ',completed:false,reward:{exp:300}},
                    {id:'master_ai_basic',name:'æŒæ¡AIåŸºç¡€ï¼ˆå­¦ä¹ 30å°æ—¶ï¼‰',type:'å­¦ä¹ ',completed:false,reward:{exp:200}},
                    
                    // è´¢å¯Œç§¯ç´¯ç³»åˆ—
                    {id:'save_100',name:'å­˜æ¬¾è¾¾åˆ°100å…ƒ',type:'è´¢å¯Œ',completed:false,reward:{exp:50}},
                    {id:'save_500',name:'å­˜æ¬¾è¾¾åˆ°500å…ƒ',type:'è´¢å¯Œ',completed:false,reward:{exp:100}},
                    {id:'save_1000',name:'å­˜æ¬¾è¾¾åˆ°1000å…ƒ',type:'è´¢å¯Œ',completed:false,reward:{exp:200}},
                    {id:'earn_100_day',name:'å•æ—¥æ”¶å…¥100å…ƒ',type:'è´¢å¯Œ',completed:false,reward:{exp:150}},
                    {id:'earn_500_day',name:'å•æ—¥æ”¶å…¥500å…ƒ',type:'è´¢å¯Œ',completed:false,reward:{exp:300}},
                    
                    // ç¤¾äº¤é‡å»ºç³»åˆ—
                    {id:'talk_to_dad',name:'å’Œçˆ¶äº²æ·±è°ˆä¸€æ¬¡',type:'ç¤¾äº¤',completed:false,reward:{exp:100}},
                    {id:'talk_to_mom',name:'å’Œæ¯äº²æ·±è°ˆä¸€æ¬¡',type:'ç¤¾äº¤',completed:false,reward:{exp:100}},
                    {id:'make_3friends',name:'ç»“è¯†3ä¸ªæ–°æœ‹å‹',type:'ç¤¾äº¤',completed:false,reward:{exp:150}},
                    {id:'join_3communities',name:'åŠ å…¥3ä¸ªç¤¾ç¾¤',type:'ç¤¾äº¤',completed:false,reward:{exp:150}},
                    {id:'help_someone',name:'å¸®åŠ©ä»–äººä¸€æ¬¡',type:'ç¤¾äº¤',completed:false,reward:{exp:120}},
                    
                    // Bossæˆ˜æ–—ç³»åˆ—
                    {id:'defeat_lazy_5',name:'æˆ˜èƒœæƒ°æ€§ä¹‹é¾™5æ¬¡',type:'æˆ˜æ–—',completed:false,reward:{exp:150}},
                    {id:'defeat_restart_5',name:'æˆ˜èƒœé‡å¼€æ¶é­”5æ¬¡',type:'æˆ˜æ–—',completed:false,reward:{exp:200}},
                    {id:'defeat_forget_5',name:'æˆ˜èƒœé—å¿˜ä¹‹é›¾5æ¬¡',type:'æˆ˜æ–—',completed:false,reward:{exp:150}},
                    {id:'defeat_compare_5',name:'æˆ˜èƒœæ¯”è¾ƒå·¨äºº5æ¬¡',type:'æˆ˜æ–—',completed:false,reward:{exp:150}},
                    {id:'defeat_comfort_5',name:'æˆ˜èƒœèˆ’é€‚é™·é˜±5æ¬¡',type:'æˆ˜æ–—',completed:false,reward:{exp:200}},
                    
                    // ç›®æ ‡è¾¾æˆç³»åˆ—
                    {id:'complete_first_goal',name:'å®Œæˆç¬¬ä¸€ä¸ªç›®æ ‡',type:'æˆå°±',completed:false,reward:{exp:80}},
                    {id:'complete_3goals',name:'å®Œæˆ3ä¸ªç›®æ ‡',type:'æˆå°±',completed:false,reward:{exp:150}},
                    {id:'complete_5goals',name:'å®Œæˆ5ä¸ªç›®æ ‡',type:'æˆå°±',completed:false,reward:{exp:250}},
                    {id:'complete_10goals',name:'å®Œæˆ10ä¸ªç›®æ ‡',type:'æˆå°±',completed:false,reward:{exp:500}},
                    
                    // è®°å½•ç³»åˆ—
                    {id:'write_5notes',name:'å†™5ç¯‡ç¬”è®°',type:'è®°å½•',completed:false,reward:{exp:100}},
                    {id:'write_10notes',name:'å†™10ç¯‡ç¬”è®°',type:'è®°å½•',completed:false,reward:{exp:200}},
                    {id:'record_30days',name:'è®°å½•30å¤©',type:'è®°å½•',completed:false,reward:{exp:300}},
                    {id:'record_60days',name:'è®°å½•60å¤©',type:'è®°å½•',completed:false,reward:{exp:500}},
                    {id:'record_90days',name:'è®°å½•90å¤©',type:'è®°å½•',completed:false,reward:{exp:800}},
                    
                    // ç‰¹æ®ŠæŒ‘æˆ˜
                    {id:'no_restart_7days',name:'7å¤©å†…ä¸æƒ³é‡å¼€',type:'æŒ‘æˆ˜',completed:false,reward:{exp:200}},
                    {id:'no_delete_30days',name:'30å¤©å†…ä¸åˆ é™¤ä»»ä½•ä¸œè¥¿',type:'æŒ‘æˆ˜',completed:false,reward:{exp:300}},
                    {id:'perfect_week',name:'å®Œç¾ä¸€å‘¨ï¼šæ¯å¤©å­¦ä¹ 3å°æ—¶',type:'æŒ‘æˆ˜',completed:false,reward:{exp:250}},
                    {id:'comeback',name:'å›åˆ°æ­¦æ±‰çˆ¶æ¯å®¶',type:'é‡è¦',completed:false,reward:{exp:500}}
                ]
            },
            chapter:1,
            // v4.0æ–°å¢å­—æ®µ
            rank:0, // æ®µä½ï¼š0=é’é“œ,1=ç™½é“¶,2=é»„é‡‘,3=é“‚é‡‘,4=é’»çŸ³,5=è¶…å‡¡,6=å®—å¸ˆ,7=ç‹è€…
            rankPoints:0, // æ®µä½ç§¯åˆ†
            buffs:{}, // å½“å‰BUFF {buffName:{endDay:X, effect:{}}}
            equipment:{ // è£…å¤‡æ 
                weapon:{name:'é¡¶é…ç”µè„‘',rarity:'SSR',effect:{æŠ€èƒ½:20,æ™ºåŠ›:15}},
                armor:null,
                accessory1:null,
                accessory2:null,
                tool1:{name:'AIå·¥å…·',rarity:'SSR',effect:{æ™ºåŠ›:15,æŠ€èƒ½:10}},
                tool2:null
            },
            equipmentInventory:['æœºæ¢°é”®ç›˜','é™å™ªè€³æœº','ç¬”è®°æœ¬','å°ç¯','æ°´æ¯','é—¹é’Ÿ'], // è£…å¤‡åº“å­˜
            achievementsUnlocked:[], // å·²è§£é”æˆå°±IDåˆ—è¡¨
            bossDefeated:{}, // Bosså‡»è´¥æ¬¡æ•° {bossId:count}
            friendsDetailed:[] // è¯¦ç»†æœ‹å‹ä¿¡æ¯ [{name,wechat,phone,personality,hobbies,notes,intimacy}]
        };
        let gameData=JSON.parse(localStorage.getItem('zhugehui_xmas2')||'null')||{...defaultData};
        function saveData(){localStorage.setItem('zhugehui_xmas2',JSON.stringify(gameData));}
        
        // v5.0 ç”Ÿæ´»ä¹ æƒ¯åˆ‡æ¢
        function toggleLifeHabit(habit){
            if(!gameData.lifeHabits)gameData.lifeHabits={};
            gameData.lifeHabits[habit]=!gameData.lifeHabits[habit];
            document.getElementById('check_'+habit).classList.toggle('checked',gameData.lifeHabits[habit]);
            updateActiveScore();
            saveData();
        }
        
        // v5.0 è®¡ç®—æ´»è·ƒåº¦
        function calculateActiveScore(){
            let score=0;
            // ç”Ÿæ´»åŸºç¡€ 35åˆ†
            if(gameData.lifeHabits){
                if(gameData.lifeHabits.washFace)score+=10;
                if(gameData.lifeHabits.breakfast)score+=5;
                if(gameData.lifeHabits.lunch)score+=5;
                if(gameData.lifeHabits.dinner)score+=5;
                if(gameData.lifeHabits.shower)score+=10;
            }
            // å­¦ä¹ å·¥ä½œ 30åˆ†
            const wH=document.getElementById('wakeHour').value;
            const wM=document.getElementById('wakeMinute').value;
            if(wH)score+=5; // è®°å½•èµ·åºŠæ—¶é—´
            const study=parseInt(document.querySelector('#studyHours .selected')?.dataset.value||0);
            if(study>=1)score+=15; // å­¦ä¹ 1å°æ—¶
            if(study>=2)score+=10; // é¢å¤–10åˆ†
            // å¨±ä¹æ”¾æ¾ 10åˆ†
            const entertainment=parseInt(document.querySelector('#entertainmentTime .selected')?.dataset.value||0);
            if(entertainment>=30)score+=10;
            // çŠ¶æ€è¯„åˆ† 5åˆ†
            const rating=parseInt(document.querySelector('#statusRating .selected')?.dataset.value||0);
            if(rating>=5)score+=5;
            
            return Math.min(100,score);
        }
        
        // v5.0 æ›´æ–°æ´»è·ƒåº¦æ˜¾ç¤º
        function updateActiveScore(){
            const score=calculateActiveScore();
            gameData.dailyActiveScore=score;
            document.getElementById('activeScore').textContent=score;
            document.getElementById('activeProgress').style.width=score+'%';
            
            let level='ğŸ”´ æ··å­',reward='å®Œæˆä»»åŠ¡æå‡æ´»è·ƒåº¦';
            if(score>=95){level='ğŸŸ£ å®Œç¾';reward='å¥–åŠ±: +50 EXP + ç¨€æœ‰å®ç®±';}
            else if(score>=80){level='ğŸ”µ ä¼˜ç§€';reward='å¥–åŠ±: +30 EXP + ç²¾è‰¯å®ç®±';}
            else if(score>=60){level='ğŸŸ¢ è‰¯å¥½';reward='å¥–åŠ±: +20 EXP + æ™®é€šå®ç®±';}
            else if(score>=40){level='ğŸŸ¡ åŠæ ¼';reward='å¥–åŠ±: +10 EXP';}
            else if(score>=20){level='ğŸŸ  æ‘¸é±¼';reward='å¥–åŠ±: +5 EXP';}
            
            document.getElementById('activeLevel').textContent=level;
            document.getElementById('activeReward').textContent=reward;
        }
        
        // v5.0 å¼€å¯å®ç®±
        function openChest(type){
            const chest=CHEST_REWARDS[type];
            if(!chest)return alert('å®ç®±ç±»å‹é”™è¯¯ï¼');
            
            // æ”¶é›†æ‰€æœ‰å¥–åŠ±
            let allRewards=[];
            ['virtual','entertainment','learning','equipment'].forEach(category=>{
                if(chest[category]){
                    chest[category].forEach(reward=>{
                        for(let i=0;i<reward.weight;i++){
                            allRewards.push({...reward,category});
                        }
                    });
                }
            });
            
            // éšæœºæŠ½å–
            const selectedReward=allRewards[Math.floor(Math.random()*allRewards.length)];
            
            // å‘æ”¾å¥–åŠ±
            let msg='';
            if(selectedReward.type==='exp'){
                gameData.levelExp+=selectedReward.amount;
                msg=`è·å¾— ${selectedReward.desc}`;
            }else if(selectedReward.type==='money'){
                gameData.money+=selectedReward.amount;
                msg=`è·å¾— ${selectedReward.desc}`;
            }else{
                msg=`è·å¾—å¥–åŠ±ï¼š${selectedReward.desc}\n\nè®°å¾—å…‘ç°ï¼è¿™æ˜¯ä½ åŠªåŠ›çš„å¥–åŠ±ï¼`;
            }
            
            checkLevelUp();
            saveData();
            render();
            
            const chestNames={normal:'ğŸ æ™®é€šå®ç®±',fine:'ğŸ ç²¾è‰¯å®ç®±',rare:'ğŸ ç¨€æœ‰å®ç®±',epic:'ğŸ å²è¯—å®ç®±',legendary:'ğŸ ä¼ è¯´å®ç®±'};
            showModal(chestNames[type]||'ğŸ å®ç®±',msg,'å¤ªæ£’äº†ï¼');
        }
        
        // v5.0 å‘æ”¾å®ç®±ï¼ˆæ ¹æ®æ´»è·ƒåº¦ï¼‰
        function grantChest(score){
            if(!gameData.chestInventory)gameData.chestInventory=[];
            if(score>=95){
                gameData.chestInventory.push({type:'rare',date:new Date().toLocaleDateString()});
            }else if(score>=80){
                gameData.chestInventory.push({type:'fine',date:new Date().toLocaleDateString()});
            }else if(score>=60){
                gameData.chestInventory.push({type:'normal',date:new Date().toLocaleDateString()});
            }
        }
        
        // v5.0 è¿ç»­ç™»å½•æ£€æµ‹
        function checkLoginReward(){
            const today=new Date().toLocaleDateString('zh-CN');
            if(gameData.lastLoginDate===today)return; // ä»Šå¤©å·²ç»ç™»å½•è¿‡
            
            const yesterday=new Date(Date.now()-86400000).toLocaleDateString('zh-CN');
            if(gameData.lastLoginDate===yesterday){
                // è¿ç»­ç™»å½•
                gameData.consecutiveDays=(gameData.consecutiveDays||0)+1;
            }else if(!gameData.lastLoginDate){
                // ç¬¬ä¸€æ¬¡ç™»å½•
                gameData.consecutiveDays=1;
            }else{
                // ä¸­æ–­äº†
                gameData.consecutiveDays=1;
            }
            
            gameData.lastLoginDate=today;
            
            const days=gameData.consecutiveDays;
            let reward='';
            let exp=0;
            
            if(days===1){exp=20;reward='+20 EXP';}
            else if(days===2){exp=25;reward='+25 EXP';}
            else if(days===3){exp=30;reward='+30 EXP + ğŸæ™®é€šå®ç®±';grantChest(60);}
            else if(days===4){exp=35;reward='+35 EXP';}
            else if(days===5){exp=40;reward='+40 EXP';}
            else if(days===6){exp=45;reward='+45 EXP';}
            else if(days===7){exp=100;reward='+100 EXP + ğŸç²¾è‰¯å®ç®± + ç§°å·"åšæŒè€…"';grantChest(80);}
            else if(days===14){exp=200;reward='+200 EXP + ğŸç¨€æœ‰å®ç®± + ç§°å·"ä¸å±ˆè€…"';grantChest(95);}
            else if(days===30){exp=500;reward='+500 EXP + ğŸå²è¯—å®ç®± + ç§°å·"æœˆåº¦ç‹è€…"';
                if(!gameData.chestInventory)gameData.chestInventory=[];
                gameData.chestInventory.push({type:'epic',date:today});
            }
            else if(days===60){exp=800;reward='+800 EXP + ğŸä¼ è¯´å®ç®± + SSRè£…å¤‡';
                if(!gameData.chestInventory)gameData.chestInventory=[];
                gameData.chestInventory.push({type:'legendary',date:today});
            }
            else if(days===90){exp=1500;reward='+1500 EXP + ğŸç¥è¯å®ç®± + ä¼ è¯´è£…å¤‡ + ç§°å·"ä¼ å¥‡"';
                if(!gameData.chestInventory)gameData.chestInventory=[];
                gameData.chestInventory.push({type:'legendary',date:today});
            }
            else if(days>=8){exp=50+Math.floor((days-7)/7)*10;reward=`+${exp} EXP`;}
            
            if(exp>0){
                gameData.levelExp=(gameData.levelExp||0)+exp;
                checkLevelUp();
                saveData();
                showModal('ğŸ‰','è¿ç»­ç™»å½•ç¬¬'+days+'å¤©',reward);
            }
        }
        
        
        // ==================== v4.0 æ–°åŠŸèƒ½å‡½æ•° ====================
        
        // æ®µä½ç³»ç»Ÿ
        function updateRank(silent=false){
            const level=gameData.level||1;
            for(let i=RANKS.length-1;i>=0;i--){
                if(level>=RANKS[i].minLevel){
                    if(gameData.rank!==i&&!silent){
                        gameData.rank=i;
                        showModal('ğŸ‰','æ®µä½æ™‹å‡!',`æ­å–œæ™‹å‡åˆ° ${RANKS[i].icon} ${RANKS[i].name}!<br>ç»§ç»­åŠ æ²¹ï¼Œå‘æ›´é«˜æ®µä½è¿›å‘ï¼`);
                        checkAchievement('rank'+i);
                    }else if(gameData.rank!==i){
                        gameData.rank=i;
                    }
                    break;
                }
            }
        }
        
        // æˆå°±æ£€æµ‹
        function checkAchievement(id){
            if(!gameData.achievementsUnlocked)gameData.achievementsUnlocked=[];
            if(gameData.achievementsUnlocked.includes(id))return;
            if(ACHIEVEMENTS[id]){
                gameData.achievementsUnlocked.push(id);
                const ach=ACHIEVEMENTS[id];
                gameData.exp+=ach.reward;
                gameData.levelExp=(gameData.levelExp||0)+ach.reward;
                showModal('ğŸ†','æˆå°±è§£é”!',`${ach.icon} ${ach.name}<br>${ach.desc}<br><span style="color:var(--gold)">+${ach.reward} EXP</span>`);
                checkLevelUp();
                saveData();
            }
        }
        
        // æ‰¹é‡æ£€æµ‹æˆå°±
        function checkAllAchievements(){
            if(!gameData.achievementsUnlocked)gameData.achievementsUnlocked=[];
            // æ—¶é—´æˆå°±
            if(gameData.consecutiveDays>=1)checkAchievement('day1');
            if(gameData.consecutiveDays>=7)checkAchievement('day7');
            if(gameData.consecutiveDays>=14)checkAchievement('day14');
            if(gameData.consecutiveDays>=30)checkAchievement('day30');
            if(gameData.consecutiveDays>=60)checkAchievement('day60');
            if(gameData.consecutiveDays>=90)checkAchievement('day90');
            // å­¦ä¹ æˆå°±
            if(gameData.totalStudyHours>=10)checkAchievement('study10');
            if(gameData.totalStudyHours>=30)checkAchievement('study30');
            if(gameData.totalStudyHours>=50)checkAchievement('study50');
            if(gameData.totalStudyHours>=100)checkAchievement('study100');
            // è´¢å¯Œæˆå°±
            if(gameData.totalIncome>0)checkAchievement('income1');
            if(gameData.totalIncome>=500)checkAchievement('income500');
            if(gameData.totalIncome>=1000)checkAchievement('income1000');
            if(gameData.totalIncome>=3000)checkAchievement('income3000');
            if(gameData.totalIncome>=5000)checkAchievement('income5000');
            if(gameData.totalIncome>=10000)checkAchievement('income10000');
            // Debuffæˆå°±
            const clearedCount=Object.values(gameData.debuffs).filter(v=>!v).length;
            if(clearedCount>=1)checkAchievement('debuff1');
            if(clearedCount>=3)checkAchievement('debuff3');
            if(clearedCount>=8)checkAchievement('debuff8');
            // Bossæˆå°±
            const bossCount=gameData.bossDefeated?Object.keys(gameData.bossDefeated).length:0;
            if(bossCount>=1)checkAchievement('boss1');
            if(bossCount>=5)checkAchievement('boss5');
            if(bossCount>=10)checkAchievement('boss10');
            if(bossCount>=20)checkAchievement('bossAll');
            // ç¤¾äº¤æˆå°±
            if(gameData.friendsDetailed&&gameData.friendsDetailed.length>=1)checkAchievement('friend1');
            if(gameData.friendsDetailed&&gameData.friendsDetailed.length>=3)checkAchievement('friend3');
            if(gameData.friendsDetailed&&gameData.friendsDetailed.length>=10)checkAchievement('friend10');
            if(gameData.communities&&gameData.communities.length>=1)checkAchievement('community1');
            // ç›®æ ‡æˆå°±
            if(gameData.goals&&gameData.goals.length>=1)checkAchievement('goal1');
            const completedGoals=gameData.goals?gameData.goals.filter(g=>g.completed).length:0;
            if(completedGoals>=1)checkAchievement('goalComplete1');
            if(completedGoals>=3)checkAchievement('goalComplete3');
            if(completedGoals>=10)checkAchievement('goalComplete10');
            // ç¬”è®°æˆå°±
            if(gameData.notes&&gameData.notes.length>=1)checkAchievement('note1');
            if(gameData.notes&&gameData.notes.length>=10)checkAchievement('note10');
            // å±æ€§æˆå°±
            const allAbove60=Object.values(gameData.attributes).every(v=>v>=60);
            if(allAbove60)checkAchievement('attr_all60');
            // ç»ˆææˆå°±
            if(gameData.level>=30){
                const allMainComplete=gameData.tasks.main.every(t=>t.completed);
                if(allMainComplete)checkAchievement('kingReturn');
            }
        }
        
        // è£…å¤‡ç®¡ç†
        function openEquipmentSlot(slot){
            if(!gameData.equipment)gameData.equipment={};
            currentEquipSlot=slot;
            const slotNames={weapon:'ä¸»æ­¦å™¨',armor:'æŠ¤ç”²',accessory1:'é¥°å“1',accessory2:'é¥°å“2',tool1:'å·¥å…·1',tool2:'å·¥å…·2'};
            document.getElementById('equipSlotTitle').textContent='è£…å¤‡'+slotNames[slot];
            let html='<div style="margin-bottom:15px"><button class="save-btn" onclick="unequipSlot()">å¸ä¸‹è£…å¤‡</button></div>';
            const validItems=Object.keys(EQUIPMENT_LIB).filter(name=>{
                const item=EQUIPMENT_LIB[name];
                return item.slot===slot||(slot==='tool1'||slot==='tool2'||slot==='accessory1'||slot==='accessory2');
            });
            validItems.forEach(name=>{
                const item=EQUIPMENT_LIB[name];
                const effectStr=Object.entries(item.effect).map(([k,v])=>`${k}+${v}`).join(', ');
                html+=`<div class="equipment-inventory-item" onclick="equipItem('${name}')">
                    <div><div style="font-weight:bold">${item.icon} ${name}</div><div style="font-size:12px;color:var(--text-dim)">${effectStr}</div></div>
                    <div class="slot-rarity ${item.rarity.toLowerCase()}">${item.rarity}</div>
                </div>`;
            });
            document.getElementById('equipSlotBody').innerHTML=html;
            document.getElementById('equipSlotModal').style.display='flex';
        }
        let currentEquipSlot='';
        function equipItem(name){
            if(!gameData.equipment)gameData.equipment={};
            gameData.equipment[currentEquipSlot]={name,rarity:EQUIPMENT_LIB[name].rarity};
            saveData();
            render();
            closeEquipSlot();
        }
        function unequipSlot(){
            if(gameData.equipment)gameData.equipment[currentEquipSlot]=null;
            saveData();
            render();
            closeEquipSlot();
        }
        function closeEquipSlot(){document.getElementById('equipSlotModal').style.display='none';}
        function showAddEquipment(){
            alert('è‡ªå®šä¹‰è£…å¤‡åŠŸèƒ½å³å°†ä¸Šçº¿ï¼\n\nç›®å‰å¯ä»¥ä»14ä»¶é¢„è®¾è£…å¤‡ä¸­é€‰æ‹©ï¼š\n\nğŸ’» é¡¶é…ç”µè„‘ã€ğŸ¤– AIå·¥å…·ã€ğŸ§  ChatGPT Plusã€ğŸ¨ Midjourney\nâŒ¨ï¸ æœºæ¢°é”®ç›˜ã€ğŸ–¥ï¸ åŒæ˜¾ç¤ºå™¨ã€ğŸ§ é™å™ªè€³æœºã€ğŸª‘ äººä½“å·¥å­¦æ¤…\nğŸ““ ç¬”è®°æœ¬ã€ğŸ’¡ å°ç¯ã€ğŸ¥¤ æ°´æ¯ã€â° é—¹é’Ÿã€ğŸ–±ï¸ é¼ æ ‡ã€ğŸ“± æ‰‹æœº');
        }
        
        // æœ‹å‹è¯¦ç»†ä¿¡æ¯
        function editFriend(index){
            if(!gameData.friendsDetailed)gameData.friendsDetailed=[];
            const friend=gameData.friendsDetailed[index]||{name:'',wechat:'',phone:'',personality:'',hobbies:'',notes:'',intimacy:50};
            document.getElementById('editFriendIndex').value=index;
            document.getElementById('friendName').value=friend.name||'';
            document.getElementById('friendWechat').value=friend.wechat||'';
            document.getElementById('friendPhone').value=friend.phone||'';
            document.getElementById('friendPersonality').value=friend.personality||'';
            document.getElementById('friendHobbies').value=friend.hobbies||'';
            document.getElementById('friendNotes').value=friend.notes||'';
            document.getElementById('friendIntimacy').value=friend.intimacy||50;
            document.getElementById('intimacyValue').textContent=friend.intimacy||50;
            document.getElementById('friendEditModal').style.display='flex';
        }
        function saveFriendEdit(){
            if(!gameData.friendsDetailed)gameData.friendsDetailed=[];
            const index=parseInt(document.getElementById('editFriendIndex').value);
            const friend={
                name:document.getElementById('friendName').value,
                wechat:document.getElementById('friendWechat').value,
                phone:document.getElementById('friendPhone').value,
                personality:document.getElementById('friendPersonality').value,
                hobbies:document.getElementById('friendHobbies').value,
                notes:document.getElementById('friendNotes').value,
                intimacy:parseInt(document.getElementById('friendIntimacy').value)
            };
            if(index>=0&&index<gameData.friendsDetailed.length){
                gameData.friendsDetailed[index]=friend;
            }else{
                gameData.friendsDetailed.push(friend);
            }
            saveData();
            render();
            closeFriendEdit();
        }
        function closeFriendEdit(){document.getElementById('friendEditModal').style.display='none';}
        
        // è®°å½•è¯¦æƒ…
        function showLogDetail(index){
            const log=gameData.dailyLogs[index];
            if(!log)return;
            document.getElementById('logDetailTitle').textContent=`Day ${log.day} - ${log.date}`;
            let html=`
                <div style="margin-bottom:20px">
                    <div style="font-size:16px;font-weight:bold;margin-bottom:10px">ğŸ“Š åŸºç¡€ä¿¡æ¯</div>
                    <div style="font-size:14px;line-height:1.8">
                        â° èµ·åºŠ: ${log.wakeTime||'æœªè®°å½•'}<br>
                        ğŸ“š å­¦ä¹ : ${log.studyHours}å°æ—¶<br>
                        ğŸ’¯ çŠ¶æ€: ${log.rating}/10<br>
                        ğŸ’° æ”¶å…¥: Â¥${log.income||0}
                    </div>
                </div>
                <div style="margin-bottom:20px">
                    <div style="font-size:16px;font-weight:bold;margin-bottom:10px">ğŸ“ æ€»ç»“</div>
                    <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:8px;font-size:14px">
                        ${log.summary||'æ— æ€»ç»“'}
                    </div>
                </div>
                <div style="margin-bottom:20px">
                    <div style="font-size:16px;font-weight:bold;margin-bottom:10px">âœ¨ å½“æ—¥BUFF</div>
                    <div id="logBuffs">æ­£åœ¨è®¡ç®—...</div>
                </div>
                <div>
                    <div style="font-size:16px;font-weight:bold;margin-bottom:10px">âš ï¸ å½“æ—¥DEBUFF</div>
                    <div id="logDebuffs">æ­£åœ¨è®¡ç®—...</div>
                </div>
            `;
            document.getElementById('logDetailBody').innerHTML=html;
            document.getElementById('logDetailModal').style.display='flex';
            // è¿™é‡Œå¯ä»¥æ ¹æ®å½“æ—¥æ•°æ®è®¡ç®—BUFF/DEBUFF
            setTimeout(()=>{
                const buffHtml=log.wakeTime<'07:00'?'<span class="debuff-tag">ğŸŸ¢ æ—©èµ·BUFF</span>':'<span style="color:var(--text-dim)">æ— BUFF</span>';
                const debuffHtml='<span style="color:var(--text-dim)">å‚è€ƒçŠ¶æ€é¡µé¢</span>';
                document.getElementById('logBuffs').innerHTML=buffHtml;
                document.getElementById('logDebuffs').innerHTML=debuffHtml;
            },100);
        }
        function closeLogDetail(){document.getElementById('logDetailModal').style.display='none';}
        
        // Bossè¯¦æƒ…
        function showBossDetail(boss){
            document.getElementById('bossDetailTitle').textContent=boss.icon+' '+boss.name;
            const defeatedCount=(gameData.bossDefeated&&gameData.bossDefeated[boss.id])||0;
            const stars='â­'.repeat(boss.diff);
            document.getElementById('bossDetailBody').innerHTML=`
                <div style="margin-bottom:15px">
                    <div style="color:var(--gold);margin-bottom:10px">${stars} éš¾åº¦${boss.diff}æ˜Ÿ</div>
                    <div style="margin-bottom:10px">${boss.desc}</div>
                </div>
                <div style="background:rgba(255,215,0,0.1);padding:15px;border-radius:8px;margin-bottom:15px">
                    <div style="font-weight:bold;margin-bottom:8px">ğŸ’¡ åº”å¯¹ç­–ç•¥</div>
                    <div style="font-size:14px">${boss.tips}</div>
                </div>
                <div style="text-align:center;padding:20px;background:rgba(255,255,255,0.05);border-radius:8px">
                    <div style="font-size:32px;margin-bottom:10px">${defeatedCount}</div>
                    <div style="color:var(--text-dim)">å·²æˆ˜èƒœæ¬¡æ•°</div>
                </div>
                <button class="save-btn" style="margin-top:20px;width:100%" onclick="recordBossWin('${boss.id}')">âš”ï¸ è®°å½•èƒœåˆ©</button>
            `;
            document.getElementById('bossDetailModal').style.display='flex';
        }
        function recordBossWin(bossId){
            if(!gameData.bossDefeated)gameData.bossDefeated={};
            gameData.bossDefeated[bossId]=(gameData.bossDefeated[bossId]||0)+1;
            gameData.exp+=20;
            gameData.levelExp=(gameData.levelExp||0)+20;
            checkAllAchievements();
            checkLevelUp();
            saveData();
            render();
            closeBossDetail();
            showModal('âš”ï¸','æˆ˜æ–—èƒœåˆ©!','æˆåŠŸæˆ˜èƒœBoss! +20 EXP');
        }
        function closeBossDetail(){document.getElementById('bossDetailModal').style.display='none';}
        
        function render(){
            try{
            // æ›´æ–°æ®µä½ï¼ˆé™é»˜æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæç¤ºï¼‰
            updateRank(true);
            const currentRank=RANKS[gameData.rank||0];
            const nextRank=RANKS[(gameData.rank||0)+1];
            
            // v5.0 æ®µä½æ˜¾ç¤º
            const rankBadge=document.getElementById('rankBadge');
            rankBadge.style.color=currentRank.color;
            if(currentRank.glow){
                rankBadge.style.boxShadow=`0 0 30px ${currentRank.glow}, inset 0 0 20px ${currentRank.glow}`;
            }
            
            // ä½¿ç”¨çœŸå®æ®µä½å›¾ç‰‡
            const rankIcon=document.getElementById('rankIcon');
            if(rankIcon&&currentRank.img){
                rankIcon.src=currentRank.img;
            }
            
            document.getElementById('rankTier').textContent=currentRank.tier;
            document.getElementById('rankTier').style.color=currentRank.color;
            document.getElementById('rankName').textContent=currentRank.name;
            document.getElementById('rankName').style.color=currentRank.color;
            
            // æ®µä½æè¿°
            const rankDescs={
                'æ··å­é»‘é“':'è¿‡å»çš„ä½ ï¼Œæµ‘æµ‘å™©å™©',
                'åŠªåŠ›é»„é“œ':'è®¤çœŸåŠªåŠ›ï¼Œè¸å®å‰è¡Œ',
                'åˆç«‹ç™½é“¶':'ç«™ç¨³è„šè·Ÿï¼Œæœ‰äº†åº•æ°”',
                'ç«‹è¶³é»„é‡‘':'ç«‹è¶³ç¤¾ä¼šï¼Œå¼€å§‹å‘å…‰',
                'è¿›æ­¥é“‚é‡‘':'ä¸æ–­è¿›æ­¥ï¼ŒæŒç»­æˆé•¿',
                'è‡ªè¶³é’»çŸ³':'è‡ªç»™è‡ªè¶³ï¼Œç»æµç‹¬ç«‹',
                'èµ·è‰²å¤§å¸ˆ':'å°æœ‰èµ·è‰²ï¼Œäº‹ä¸šç¨³å®š',
                'æœˆä¸‡å®—å¸ˆ':'æœˆå…¥è¿‡ä¸‡ï¼Œç ´èŒ§æˆè¶',
                'ä¹è½¬ç‹è€…':'ç‹è€…å½’æ¥ï¼Œå®Œæˆèœ•å˜'
            };
            document.getElementById('rankDesc').textContent=rankDescs[currentRank.tier]||'ç»§ç»­åŠ æ²¹ï¼';
            
            if(nextRank){
                const gap=nextRank.minLevel-(gameData.level||1);
                document.getElementById('rankLevelGap').textContent=gap>0?gap:0;
                const progress=Math.min(100,((gameData.level||1)-currentRank.minLevel)/(nextRank.minLevel-currentRank.minLevel)*100);
                document.getElementById('rankProgress').style.width=progress+'%';
                
                // å¦‚æœæ˜¯ç‹è€…å°±ç‰¹æ®Šæ˜¾ç¤º
                if(currentRank.special){
                    document.getElementById('rankProgressText').innerHTML='ğŸ‰ å·²è¾¾å·…å³°ï¼ä¹è½¬æˆäººï¼';
                }else{
                    document.getElementById('rankProgressText').innerHTML='è·ç¦» <strong>'+nextRank.name+'</strong> è¿˜éœ€ <span id="rankLevelGap">'+gap+'</span> çº§';
                }
            }else{
                document.getElementById('rankProgressText').innerHTML='ğŸ‰ å·²è¾¾å·…å³°ï¼ä¹è½¬æˆäººï¼';
                document.getElementById('rankProgress').style.width='100%';
            }
            
            // ç­‰çº§ä¿¡æ¯
            document.getElementById('dayDisplay').textContent='ğŸ„ Day '+gameData.day+' ğŸ';
            document.getElementById('headerLevel').textContent='Lv.'+(gameData.level||1);
            document.getElementById('currentLevel').textContent=gameData.level||1;
            let expNeeded;
            // v5.0 ç»éªŒæ›²çº¿
            const currentLevel=gameData.level||1;
            if(currentLevel<=3)expNeeded=150;
            else if(currentLevel<=7)expNeeded=200;
            else if(currentLevel<=11)expNeeded=300;
            else if(currentLevel<=15)expNeeded=400;
            else if(currentLevel<=19)expNeeded=500;
            else if(currentLevel<=23)expNeeded=600;
            else if(currentLevel<=26)expNeeded=700;
            else if(currentLevel===27||currentLevel===28)expNeeded=800;
            else if(currentLevel===29)expNeeded=1000;
            else expNeeded=1500;
            document.getElementById('levelExpValue').textContent=(gameData.levelExp||0)+'/'+expNeeded;
            document.getElementById('levelExpBar').style.width=((gameData.levelExp||0)/expNeeded*100)+'%';
            
            // æ›´æ–°ç­‰çº§å¥–åŠ±æç¤º
            let nextReward='å‡çº§å¥–åŠ±: HP+10, MP+10, å…¨å±æ€§+2';
            if((gameData.level||1)===5||(gameData.level||1)===10||(gameData.level||1)===15||(gameData.level||1)===20){
                nextReward+=' | ğŸä¸‹ä¸€çº§æ‰€éœ€ç»éªŒæå‡ï¼';
            }
            document.getElementById('levelBonus').textContent=nextReward;
            
            document.getElementById('hpValue').textContent=gameData.hp+'/100';document.getElementById('hpBar').style.width=gameData.hp+'%';
            document.getElementById('mpValue').textContent=gameData.mp+'/100';document.getElementById('mpBar').style.width=gameData.mp+'%';
            document.getElementById('expValue').textContent=gameData.exp+'/1000';document.getElementById('expBar').style.width=gameData.exp/10+'%';
            const icons={'ä½“è´¨':'ğŸ’ª','ç²¾ç¥':'ğŸ§ ','é­…åŠ›':'âœ¨','æ™ºåŠ›':'ğŸ“š','æ„å¿—':'ğŸ”¥','ç¤¾äº¤':'ğŸ‘¥','è´¢å¯Œ':'ğŸ’°','æŠ€èƒ½':'ğŸ› ï¸'};
            let a='';for(const[n,v]of Object.entries(gameData.attributes)){a+='<div class="stat-item"><div class="stat-header"><span>'+icons[n]+' '+n+'</span><span>'+v+'/100</span></div><div class="stat-bar"><div class="stat-fill attr" style="width:'+v+'%"></div></div></div>';}document.getElementById('attributesList').innerHTML=a;
            let d='';for(const[n,x]of Object.entries(gameData.debuffs)){d+='<div class="debuff-tag '+(x?'active':'cleared')+'" onclick="toggleDebuff(\''+n+'\')">'+(x?'ğŸ”´':'âœ…')+' '+n+'</div>';}document.getElementById('debuffList').innerHTML=d;
            document.getElementById('equipmentList').innerHTML='<div class="task-item"><div class="task-header"><span class="task-title">â­â­â­ é¡¶é…ç”µè„‘</span><span class="task-exp">SSR</span></div></div><div class="task-item"><div class="task-header"><span class="task-title">â­â­â­ AIå·¥å…·</span><span class="task-exp">SSR</span></div></div>';
            const tasks=[{id:'water',name:'ğŸ’§ å–æ°´2å‡',exp:5},{id:'meals',name:'ğŸ½ï¸ åƒ2é¡¿é¥­',exp:5},{id:'wake',name:'â° è®°å½•èµ·åºŠ',exp:5}];let tk='';tasks.forEach(t=>{const c=gameData.tasks?.daily?.[t.id]||false;tk+='<div class="task-check"><div class="checkbox '+(c?'checked':'')+'" onclick="toggleTask(\''+t.id+'\')"></div><span>'+t.name+'</span><span style="margin-left:auto;color:var(--gold);font-size:12px">+'+t.exp+'</span></div>';});document.getElementById('dailyTasks').innerHTML=tk;
            
            // v5.0 æ´»è·ƒåº¦æ˜¾ç¤º
            const activeScore=gameData.dailyActiveScore||0;
            document.getElementById('activeScore').textContent=activeScore;
            document.getElementById('activeProgress').style.width=activeScore+'%';
            let activeLevel='ğŸ”´ æ··å­',activeReward='æ— å¥–åŠ±';
            if(activeScore>=95){activeLevel='ğŸŸ£ å®Œç¾';activeReward='+30 EXP + ğŸç¨€æœ‰å®ç®±';}
            else if(activeScore>=80){activeLevel='ğŸ”µ ä¼˜ç§€';activeReward='+20 EXP + ğŸç²¾è‰¯å®ç®±';}
            else if(activeScore>=60){activeLevel='ğŸŸ¢ è‰¯å¥½';activeReward='+10 EXP + ğŸæ™®é€šå®ç®±';}
            else if(activeScore>=40){activeLevel='ğŸŸ¡ åŠæ ¼';activeReward='+5 EXP';}
            else if(activeScore>=20){activeLevel='ğŸŸ  æ‘¸é±¼';activeReward='+2 EXP';}
            document.getElementById('activeLevel').textContent=activeLevel;
            document.getElementById('activeReward').textContent=activeReward;
            if(gameData.lifeHabits){
                document.getElementById('check_washFace').classList.toggle('checked',gameData.lifeHabits.washFace||false);
                document.getElementById('check_breakfast').classList.toggle('checked',gameData.lifeHabits.breakfast||false);
                document.getElementById('check_lunch').classList.toggle('checked',gameData.lifeHabits.lunch||false);
                document.getElementById('check_dinner').classList.toggle('checked',gameData.lifeHabits.dinner||false);
                document.getElementById('check_shower').classList.toggle('checked',gameData.lifeHabits.shower||false);
            }
            let ch=gameData.day<=30?'ğŸ„ ç¬¬ä¸€ç« :ç”Ÿå­˜æœŸ (Day 1-30)':gameData.day<=60?'ğŸ ç¬¬äºŒç« :æ¢å¤æœŸ (Day 31-60)':gameData.day<=90?'â­ ç¬¬ä¸‰ç« :å¯åŠ¨æœŸ (Day 61-90)':'ğŸš€ ç¬¬å››ç« :è…¾é£æœŸ (Day 91+)';
            document.getElementById('currentChapter').innerHTML='<div style="font-size:18px;font-weight:bold">'+ch+'</div><div style="margin-top:10px"><div class="stat-bar"><div class="stat-fill exp" style="width:'+(gameData.day%30)/30*100+'%"></div></div></div><div style="font-size:12px;color:var(--text-dim);margin-top:5px">Day '+gameData.day+'/30</div>';
            
            // ä¸»çº¿ä»»åŠ¡æ¸²æŸ“ - æ ¹æ®ç­‰çº§è§£é”
            const mainTasks=gameData.tasks.main||[];
            let mainHtml='';
            mainTasks.forEach((task,idx)=>{
                const isLocked=!task.unlocked&&task.level>currentLevel;
                const progress=task.progress||0;
                const percent=Math.min(100,(progress/task.target)*100);
                const typeTag=task.type?`<span style="font-size:11px;padding:2px 6px;background:rgba(255,215,0,0.2);border-radius:8px;margin-left:5px">${task.type}</span>`:'';
                mainHtml+=`<div class="task-item ${task.completed?'completed':''} ${isLocked?'locked':''}">
                    <div class="task-header">
                        <span class="task-title">${isLocked?'ğŸ”’':'ğŸ“'} ${task.completed?'âœ…':''} Lv.${task.level} ${task.name}${typeTag}</span>
                        <span class="task-exp">+${task.reward.exp}EXP${task.reward.money?` +Â¥${task.reward.money}`:''}</span>
                    </div>
                    ${!isLocked?`<div class="stat-bar" style="margin-top:8px">
                        <div class="stat-fill ${task.completed?'hp':'exp'}" style="width:${task.completed?100:percent}%"></div>
                    </div>
                    <div style="font-size:12px;color:var(--text-dim);margin-top:5px">${progress}/${task.target}</div>`:`<div style="font-size:12px;color:var(--text-dim);margin-top:5px">éœ€è¦Lv.${task.level}è§£é”</div>`}
                </div>`;
            });
            document.getElementById('mainTasks').innerHTML=mainHtml||'<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div>æš‚æ— ä¸»çº¿ä»»åŠ¡</div></div>';
            
            // æ”¯çº¿ä»»åŠ¡æ¸²æŸ“ - æŒ‰ç±»å‹åˆ†ç»„
            const sideTasks=gameData.tasks.side||[];
            const sideTypes={'åŸºç¡€':'ğŸŒ±','ä¹ æƒ¯':'â°','æˆé•¿':'ğŸŒŸ','å­¦ä¹ ':'ğŸ“š','è´¢å¯Œ':'ğŸ’°','ç¤¾äº¤':'ğŸ‘¥','æˆ˜æ–—':'âš”ï¸','æˆå°±':'ğŸ†','è®°å½•':'ğŸ“','æŒ‘æˆ˜':'ğŸ’ª','é‡è¦':'â­'};
            let sideByType={};
            sideTasks.forEach(task=>{
                const type=task.type||'å…¶ä»–';
                if(!sideByType[type])sideByType[type]=[];
                sideByType[type].push(task);
            });
            let sideHtml='';
            Object.keys(sideByType).forEach(type=>{
                const icon=sideTypes[type]||'ğŸ“Œ';
                sideHtml+=`<div style="margin-top:15px"><div style="font-size:14px;font-weight:bold;color:var(--gold);margin-bottom:10px">${icon} ${type}</div>`;
                sideByType[type].forEach((task,idx)=>{
                    const globalIdx=sideTasks.indexOf(task);
                    sideHtml+=`<div class="task-item ${task.completed?'completed':''}">
                        <div class="task-check">
                            <div class="checkbox ${task.completed?'checked':''}" onclick="toggleSideTask(${globalIdx})"></div>
                            <span style="${task.completed?'text-decoration:line-through;color:var(--text-dim)':''}">${task.name}</span>
                        </div>
                        <div style="margin-top:5px;font-size:12px;color:var(--gold)">å¥–åŠ±: +${task.reward.exp}EXP</div>
                    </div>`;
                });
                sideHtml+=`</div>`;
            });
            document.getElementById('sideTasks').innerHTML=sideHtml||'<div class="empty-state"><div class="empty-icon">ğŸ“Œ</div><div>æš‚æ— æ”¯çº¿ä»»åŠ¡</div></div>';
            document.getElementById('familyList').innerHTML=(gameData.family||[{name:'çˆ¶äº²',type:'å®¶äºº',intimacy:80},{name:'æ¯äº²',type:'å®¶äºº',intimacy:60}]).map((f,i)=>`<div class="social-contact"><div class="contact-header"><span class="contact-name">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ${f.name}</span><span class="contact-type">${f.type}</span><span style="cursor:pointer;margin-left:10px" onclick="deleteFamily(${i})">ğŸ—‘ï¸</span></div><div class="intimacy-bar"><div class="intimacy-fill" style="width:${f.intimacy||50}%"></div></div>${f.notes?`<div style="font-size:11px;color:var(--text-dim);margin-top:5px">${f.notes}</div>`:''}</div>`).join('');
            document.getElementById('communityList').innerHTML=gameData.communities.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ’¬</div><div>è¿˜æ²¡æœ‰ç¤¾ç¾¤</div></div>':gameData.communities.map((c,i)=>'<div class="social-contact"><div class="contact-header"><span class="contact-name">'+c.name+'</span><span class="contact-type">'+c.platform+'</span><span style="cursor:pointer;margin-left:10px" onclick="deleteCommunity('+i+')">ğŸ—‘ï¸</span></div></div>').join('');
            document.getElementById('newFriendsList').innerHTML=gameData.friends.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ¤</div><div>è¿˜æ²¡æœ‰æ–°æœ‹å‹</div></div>':gameData.friends.map((f,i)=>'<div class="social-contact"><div class="contact-header"><span class="contact-name">'+f.name+'</span><span style="cursor:pointer;margin-left:10px" onclick="deleteFriend('+i+')">ğŸ—‘ï¸</span></div></div>').join('');
            const allAch=[{id:'day1',name:'èµ·æ­¥è€…',desc:'å®ŒæˆDay1',icon:'ğŸŒ±'},{id:'week1',name:'ä¸ƒæ—¥åšæŒ',desc:'è¿ç»­7å¤©',icon:'ğŸ“…'},{id:'day30',name:'ä¸‰åæ—¥å‹‡å£«',desc:'å®Œæˆç¬¬ä¸€ç« ',icon:'âš”ï¸'}];const unlocked=Object.keys(gameData.achievements).filter(k=>gameData.achievements[k]);document.getElementById('achievementProgress').innerHTML='<div style="font-size:24px;font-weight:bold;text-align:center;color:var(--gold)">'+unlocked.length+'/'+allAch.length+'</div>';document.getElementById('allAchievements').innerHTML=allAch.map(a=>'<div class="achievement-item '+(gameData.achievements[a.id]?'unlocked':'')+'"><div class="achievement-icon">'+(gameData.achievements[a.id]?a.icon:'ğŸ”’')+'</div><div class="achievement-info"><div class="achievement-name">'+a.name+'</div><div class="achievement-desc">'+a.desc+'</div></div></div>').join('');
            document.getElementById('totalDays').textContent=gameData.day;document.getElementById('totalStudy').textContent=gameData.totalStudyHours;document.getElementById('totalIncome').textContent=gameData.totalIncome;
            document.getElementById('historyList').innerHTML=gameData.dailyLogs.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ“</div><div>è¿˜æ²¡æœ‰è®°å½•</div></div>':gameData.dailyLogs.slice(-5).reverse().map((l,i)=>{const realIndex=gameData.dailyLogs.length-1-i;return '<div class="history-item" onclick="showLogDetail('+realIndex+')" style="cursor:pointer"><div class="history-date">Day '+l.day+' | '+l.date+'</div><div class="history-stats"><div class="history-stat"><div class="history-stat-value">'+(l.wakeTime||'-')+'</div><div>èµ·åºŠ</div></div><div class="history-stat"><div class="history-stat-value">'+(l.studyHours||0)+'h</div><div>å­¦ä¹ </div></div><div class="history-stat"><div class="history-stat-value">'+(l.rating||'-')+'</div><div>çŠ¶æ€</div></div></div><div style="text-align:center;font-size:11px;color:var(--text-dim);margin-top:5px">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div></div>';}).join('');
            document.getElementById('bossLog').innerHTML=gameData.bossEncounters.length===0?'<div class="empty-state"><div class="empty-icon">âš”ï¸</div><div>è¿˜æ²¡æœ‰Bossæˆ˜</div></div>':gameData.bossEncounters.slice(-3).reverse().map(e=>'<div class="history-item"><div class="history-date">'+e.date+'</div><div>ğŸ‘¹ '+e.boss+' - '+(e.won?'âœ…èƒœåˆ©':'âŒå¤±è´¥')+'</div></div>').join('');
            
            // è´¢åŠ¡æ¸²æŸ“
            document.getElementById('currentMoney').textContent='Â¥'+(gameData.money||0).toFixed(2);
            document.getElementById('totalIncomeDisplay').textContent='Â¥'+(gameData.totalIncome||0).toFixed(2);
            document.getElementById('totalExpenseDisplay').textContent='Â¥'+(gameData.totalExpense||0).toFixed(2);
            const trans=gameData.transactions||[];
            document.getElementById('transactionsList').innerHTML=trans.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ’°</div><div>è¿˜æ²¡æœ‰è®°å½•</div></div>':trans.slice(-10).reverse().map(t=>'<div class="transaction-item"><div class="transaction-desc"><div>'+t.note+'</div><div class="transaction-date">'+t.date+'</div></div><div class="transaction-amount '+(t.type==='income'?'income':'expense')+'">'+(t.type==='income'?'+':'-')+'Â¥'+t.amount.toFixed(2)+'</div></div>').join('');
            
            // ç¬”è®°æ¸²æŸ“
            const notes=gameData.notes||[];
            document.getElementById('notesList').innerHTML=notes.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ“</div><div>è¿˜æ²¡æœ‰ç¬”è®°</div></div>':notes.map((n,i)=>'<div class="custom-note"><div class="custom-note-title">'+n.title+' <span style="float:right;cursor:pointer" onclick="deleteNote('+i+')">ğŸ—‘ï¸</span></div><div class="custom-note-content">'+n.content+'</div></div>').join('');
            
            // ç›®æ ‡æ¸²æŸ“
            const goals=gameData.goals||[];
            document.getElementById('goalsList').innerHTML=goals.length===0?'<div class="empty-state"><div class="empty-icon">ğŸ¯</div><div>è¿˜æ²¡æœ‰ç›®æ ‡</div></div>':goals.map((g,i)=>'<div class="custom-goal"><span class="goal-checkbox '+(g.completed?'checked':'')+'" onclick="toggleGoal('+i+')"></span><span style="'+(g.completed?'text-decoration:line-through;color:var(--text-dim)':'')+'">'+ g.text+'</span><span style="float:right;cursor:pointer" onclick="deleteGoal('+i+')">ğŸ—‘ï¸</span></div>').join('');
            
            // è£…å¤‡æ¸²æŸ“
            if(!gameData.equipment)gameData.equipment={};
            const equip=gameData.equipment;
            ['weapon','armor','accessory1','accessory2','tool1','tool2'].forEach(slot=>{
                const slotEl=document.getElementById('slot_'+slot);
                if(equip[slot]&&equip[slot].name){
                    slotEl.textContent=equip[slot].name;
                    slotEl.classList.remove('empty');
                    const parent=slotEl.parentElement;
                    const existing=parent.querySelector('.slot-rarity');
                    if(existing)existing.remove();
                    const rarityEl=document.createElement('div');
                    rarityEl.className='slot-rarity '+equip[slot].rarity.toLowerCase();
                    rarityEl.textContent=equip[slot].rarity;
                    parent.appendChild(rarityEl);
                }else{
                    slotEl.textContent='ç©º';
                    slotEl.classList.add('empty');
                    const parent=slotEl.parentElement;
                    const existing=parent.querySelector('.slot-rarity');
                    if(existing)existing.remove();
                }
            });
            
            // è£…å¤‡åº“å­˜æ¸²æŸ“
            const inventory=Object.keys(EQUIPMENT_LIB);
            let invHtml='';
            inventory.forEach(name=>{
                const item=EQUIPMENT_LIB[name];
                const equipped=Object.values(equip).some(e=>e&&e.name===name);
                if(!equipped){
                    const effectStr=Object.entries(item.effect).map(([k,v])=>`${k}+${v}`).join(', ');
                    invHtml+=`<div class="equipment-inventory-item"><div><div style="font-weight:bold">${item.icon} ${name}</div><div style="font-size:12px;color:var(--text-dim)">${effectStr}</div></div><div class="slot-rarity ${item.rarity.toLowerCase()}">${item.rarity}</div></div>`;
                }
            });
            document.getElementById('equipmentInventory').innerHTML=invHtml||'<div style="text-align:center;color:var(--text-dim);padding:20px">æ‰€æœ‰è£…å¤‡å·²è£…å¤‡</div>';
            
            // è£…å¤‡åŠ æˆè®¡ç®—
            let bonus={};
            Object.values(equip).forEach(item=>{
                if(item&&EQUIPMENT_LIB[item.name]){
                    const effect=EQUIPMENT_LIB[item.name].effect;
                    for(let attr in effect){
                        bonus[attr]=(bonus[attr]||0)+effect[attr];
                    }
                }
            });
            let bonusHtml='';
            for(let attr in bonus){
                bonusHtml+=`<div style="padding:8px;background:rgba(255,215,0,0.1);border-radius:6px;margin-bottom:8px"><span style="font-weight:bold">${attr}</span>: +${bonus[attr]}</div>`;
            }
            document.getElementById('equipmentBonus').innerHTML=bonusHtml||'<div style="text-align:center;color:var(--text-dim);padding:20px">æš‚æ— è£…å¤‡åŠ æˆ</div>';
            
            // æˆå°±æ¸²æŸ“
            if(!gameData.achievementsUnlocked)gameData.achievementsUnlocked=[];
            let achHtml='<div class="achievement-grid">';
            let achCount=0;
            for(let id in ACHIEVEMENTS){
                const ach=ACHIEVEMENTS[id];
                const unlocked=gameData.achievementsUnlocked.includes(id);
                achHtml+=`<div class="achievement-card ${unlocked?'unlocked':''}">
                    <div class="achievement-icon">${ach.icon}</div>
                    <div class="achievement-name">${ach.name}</div>
                    <div class="achievement-desc">${ach.desc}</div>
                    <div class="achievement-reward">${unlocked?'âœ… å·²è§£é”':'ğŸ”’ æœªè§£é”'} | +${ach.reward} EXP</div>
                </div>`;
                achCount++;
                if(achCount>=20)break; // åªæ˜¾ç¤ºå‰20ä¸ªï¼Œé¿å…è¿‡é•¿
            }
            achHtml+='</div>';
            document.getElementById('allAchievements').innerHTML=achHtml;
            const achProgress=`å·²è§£é” ${gameData.achievementsUnlocked.length}/${Object.keys(ACHIEVEMENTS).length} ä¸ªæˆå°±`;
            document.getElementById('achievementProgress').innerHTML=`<div style="text-align:center;padding:20px;font-size:18px;font-weight:bold;color:var(--gold)">${achProgress}</div>`;
            
            // Bossåº“æ¸²æŸ“
            let bossHtml='';
            BOSS_LIBRARY.forEach(boss=>{
                const defeatedCount=(gameData.bossDefeated&&gameData.bossDefeated[boss.id])||0;
                const stars='â­'.repeat(boss.diff);
                bossHtml+=`<div class="boss-card" onclick="showBossDetail(BOSS_LIBRARY.find(b=>b.id==='${boss.id}'))">
                    <div class="boss-card-header">
                        <div class="boss-card-title">${boss.icon} ${boss.name}</div>
                        <div class="boss-difficulty">${stars}</div>
                    </div>
                    <div class="boss-desc">${boss.desc}</div>
                    <div class="boss-stats">
                        <div class="boss-stat">å‡»è´¥æ¬¡æ•°: <strong>${defeatedCount}</strong></div>
                    </div>
                </div>`;
            });
            document.getElementById('bossLibrary').innerHTML=bossHtml;
            
            // æœ‹å‹è¯¦ç»†ä¿¡æ¯æ¸²æŸ“
            if(!gameData.friendsDetailed)gameData.friendsDetailed=[];
            if(gameData.friendsDetailed.length>0){
                let friendHtml='';
                gameData.friendsDetailed.forEach((f,i)=>{
                    friendHtml+=`<div class="social-contact" onclick="editFriend(${i})" style="cursor:pointer">
                        <div class="contact-header">
                            <span class="contact-name">ğŸ¤ ${f.name||'æœªå‘½å'}</span>
                            <span class="contact-type">${f.wechat?'ğŸ“±':'ğŸ‘¤'}</span>
                        </div>
                        <div class="intimacy-bar"><div class="intimacy-fill" style="width:${f.intimacy||50}%"></div></div>
                        ${f.phone||f.wechat?`<div style="font-size:11px;color:var(--text-dim);margin-top:5px">${f.phone||''} ${f.wechat||''}</div>`:''}
                        <div style="text-align:center;font-size:10px;color:var(--text-dim);margin-top:5px">ç‚¹å‡»ç¼–è¾‘</div>
                    </div>`;
                });
                // å¦‚æœæœ‰è¯¦ç»†æœ‹å‹ä¿¡æ¯ï¼Œæ›¿æ¢ç®€å•çš„æœ‹å‹åˆ—è¡¨
                const friendListEl=document.getElementById('newFriendsList');
                if(friendListEl&&friendHtml){
                    friendListEl.innerHTML=friendHtml+'<button class="save-btn" onclick="editFriend(-1)" style="margin-top:15px">â• æ·»åŠ æ–°æœ‹å‹</button>';
                }
            }
            
            // v5.0 æ›´æ–°æ´»è·ƒåº¦æ˜¾ç¤º
            updateActiveScore();
            
            }catch(error){
                console.error('âŒ Renderé”™è¯¯:',error);
                console.error('é”™è¯¯å †æ ˆ:',error.stack);
                // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
                const errorMsg='é¡µé¢æ¸²æŸ“å‡ºé”™ï¼\né”™è¯¯: '+error.message+'\n\nè¯·æˆªå›¾æ­¤ä¿¡æ¯å¹¶åé¦ˆã€‚\n\nå°è¯•åˆ·æ–°é¡µé¢æˆ–æ¸…é™¤æ•°æ®é‡è¯•ã€‚';
                alert(errorMsg);
            }
        }
        function toggleDebuff(n){
            gameData.debuffs[n]=!gameData.debuffs[n];
            if(!gameData.debuffs[n]){
                gameData.exp+=50;
                gameData.levelExp=(gameData.levelExp||0)+50;
                
                // æ›´æ–°ä¸»çº¿ä»»åŠ¡ï¼šæ¸…é™¤3ä¸ªDebuff
                if(gameData.tasks.main){
                    const task=gameData.tasks.main.find(t=>t.id==='clear3debuffs');
                    if(task&&!task.completed){
                        const clearedCount=Object.values(gameData.debuffs).filter(v=>!v).length;
                        task.progress=clearedCount;
                        if(task.progress>=task.target){
                            task.completed=true;
                            gameData.exp+=task.reward.exp;
                            gameData.levelExp+=task.reward.exp;
                            showModal('ğŸ¯','ä¸»çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);
                        }
                    }
                }
                
                checkLevelUp();
                showModal('ğŸ‰','Debuffè§£é™¤!','"'+n+'"å·²æ¸…é™¤! +50 EXP');
            }
            saveData();
            render();
        }
        function toggleTask(id){if(!gameData.tasks.daily)gameData.tasks.daily={};gameData.tasks.daily[id]=!gameData.tasks.daily[id];if(gameData.tasks.daily[id])gameData.exp+=5;saveData();render();}
        
        // v5.0 ç”Ÿæ´»ä¹ æƒ¯ç³»ç»Ÿ
        function toggleLifeHabit(habit){
            if(!gameData.lifeHabits)gameData.lifeHabits={};
            gameData.lifeHabits[habit]=!gameData.lifeHabits[habit];
            calculateActiveScore();
            saveData();
            render();
        }
        
        // v5.0 æ´»è·ƒåº¦è®¡ç®—
        function calculateActiveScore(){
            if(!gameData.lifeHabits)gameData.lifeHabits={};
            let score=0;
            
            // ç”Ÿæ´»åŸºç¡€ 35åˆ†
            if(gameData.lifeHabits.washFace)score+=10;
            if(gameData.lifeHabits.breakfast)score+=5;
            if(gameData.lifeHabits.lunch)score+=5;
            if(gameData.lifeHabits.dinner)score+=5;
            if(gameData.lifeHabits.shower)score+=10;
            
            // å­¦ä¹ å·¥ä½œ 30åˆ†ï¼ˆé€šè¿‡æ—¥å¿—è®°å½•ï¼‰
            const study=parseInt(document.querySelector('#studyHours .selected')?.dataset.value||0);
            if(study>=1)score+=15;
            if(study>=3)score+=15;
            
            // å¨±ä¹æ”¾æ¾ 10åˆ†
            const entertainment=parseInt(document.querySelector('#entertainmentTime .selected')?.dataset.value||0);
            if(entertainment>=30)score+=10;
            
            // æ¯æ—¥ä»»åŠ¡ 15åˆ†
            const wakeTime=document.getElementById('wakeHour').value;
            if(wakeTime)score+=5;
            
            const dailyCompleted=Object.values(gameData.tasks?.daily||{}).filter(v=>v).length;
            score+=Math.min(10,dailyCompleted*5);
            
            gameData.dailyActiveScore=Math.min(100,score);
            return score;
        }
        
        function saveDailyLog(){
            const wH=document.getElementById('wakeHour').value,wM=document.getElementById('wakeMinute').value,study=document.querySelector('#studyHours .selected')?.dataset.value||0,rating=document.querySelector('#statusRating .selected')?.dataset.value||0,income=parseFloat(document.getElementById('dailyIncome').value)||0,summary=document.getElementById('dailySummary').value;
            const entertainment=parseInt(document.querySelector('#entertainmentTime .selected')?.dataset.value||0);
            
            // v5.0 è®¡ç®—æ´»è·ƒåº¦
            const activeScore=calculateActiveScore();
            
            // v5.0 è®°å½•å¨±ä¹æ—¥å¿—
            if(entertainment>0){
                if(!gameData.entertainmentLog)gameData.entertainmentLog=[];
                gameData.entertainmentLog.push({
                    date:new Date().toLocaleDateString('zh-CN'),
                    duration:entertainment,
                    type:'daily',
                    happiness:Math.floor(rating/2)+5, // æ ¹æ®çŠ¶æ€è¯„åˆ†ä¼°ç®—å¿«ä¹åº¦
                    note:summary
                });
            }
            
            gameData.dailyLogs.push({day:gameData.day,date:new Date().toLocaleDateString('zh-CN'),wakeTime:wH?wH+':'+(wM||'00'):'',studyHours:parseInt(study),rating:parseInt(rating),income,summary,activeScore});
            gameData.totalStudyHours+=parseInt(study);
            gameData.totalIncome+=income;
            gameData.consecutiveDays++;
            
            // v5.0 æ´»è·ƒåº¦å¥–åŠ±
            let activeBonus=0;
            if(activeScore>=60)activeBonus=10;
            if(activeScore>=80)activeBonus=20;
            if(activeScore>=95)activeBonus=30;
            
            // v5.0 å‘æ”¾å®ç®±
            grantChest(activeScore);
            
            const gainedExp=20+(study>=2?20:0)+(income>0?30:0)+activeBonus;
            gameData.exp+=gainedExp;
            gameData.levelExp=(gameData.levelExp||0)+gainedExp;
            gameData.mp=Math.min(100,gameData.mp+parseInt(rating));
            
            // æ›´æ–°ä¸»çº¿ä»»åŠ¡è¿›åº¦
            if(!gameData.tasks.main)gameData.tasks.main=[];
            let completedTasks=[];
            gameData.tasks.main.forEach(task=>{
                if(task.completed||!task.unlocked)return;
                // è¿ç»­è®°å½•ç±»
                if(task.id.includes('consecutive')||task.id==='start_journey'){
                    task.progress=gameData.consecutiveDays;
                }
                // å­¦ä¹ æ—¶é•¿ç±»
                if(task.id.includes('study')){
                    task.progress=gameData.totalStudyHours;
                }
                // æ”¶å…¥ç±»
                if(task.id.includes('income')||task.id==='rebirth_complete'){
                    task.progress=gameData.totalIncome;
                }
                // ç« èŠ‚å®Œæˆç±»
                if(task.id.includes('chapter')&&task.id.includes('complete')){
                    task.progress=gameData.day;
                }
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if(task.progress>=task.target){
                    task.completed=true;
                    gameData.exp+=task.reward.exp;
                    gameData.levelExp+=task.reward.exp;
                    if(task.reward.money){
                        gameData.money+=task.reward.money;
                    }
                    completedTasks.push({name:task.name,reward:task.reward});
                }
            });
            // æ˜¾ç¤ºå®Œæˆçš„ä»»åŠ¡
            if(completedTasks.length>0){
                completedTasks.forEach(t=>{
                    showModal('ğŸ¯','ä¸»çº¿å®Œæˆ!',`"${t.name}"å·²å®Œæˆ! +${t.reward.exp}EXP${t.reward.money?` +Â¥${t.reward.money}`:''}`);
                });
            }
            
            if(!gameData.achievements.day1){gameData.achievements.day1=true;gameData.exp+=50;gameData.levelExp=(gameData.levelExp||0)+50;}
            if(gameData.consecutiveDays>=7&&!gameData.achievements.week1){gameData.achievements.week1=true;gameData.exp+=100;gameData.levelExp=(gameData.levelExp||0)+100;}
            if(gameData.day>=30&&!gameData.achievements.day30){gameData.achievements.day30=true;gameData.exp+=200;gameData.levelExp=(gameData.levelExp||0)+200;showModal('ğŸ†','æˆå°±è¾¾æˆ!','å®Œæˆç¬¬ä¸€ç« ! +200EXP');}
            
            // v4.0 æˆå°±æ£€æµ‹
            checkAllAchievements();
            // å•æ—¥å­¦ä¹ æˆå°±
            if(parseInt(study)>=5)checkAchievement('study5day');
            // å•æ—¥æ”¶å…¥æˆå°±
            if(income>=100)checkAchievement('income100day');
            if(income>=500)checkAchievement('income500day');
            
            checkLevelUp();
            gameData.day++;
            gameData.tasks.daily={};
            saveData();
            showModal('ğŸ“','è®°å½•æˆåŠŸ!','Day '+(gameData.day-1)+' å®Œæˆ!');
            document.getElementById('wakeHour').value='';
            document.getElementById('wakeMinute').value='';
            document.getElementById('dailyIncome').value='';
            document.getElementById('dailySummary').value='';
            document.querySelectorAll('.rating-btn').forEach(b=>b.classList.remove('selected'));
            render();
        }
        function addCommunity(){const n=prompt('ç¤¾ç¾¤åç§°:');if(!n)return;const p=prompt('å¹³å°:')||'æœªçŸ¥';gameData.communities.push({name:n,platform:p});saveData();render();showModal('ğŸ’¬','æ·»åŠ æˆåŠŸ!','åŠ å…¥: '+n);}
        function addFriend(){const n=prompt('æ˜µç§°:');if(!n)return;const isFirst=gameData.friends.length===0;gameData.friends.push({name:n,source:'ç¤¾ç¾¤'});if(isFirst&&gameData.tasks.side){const task=gameData.tasks.side.find(t=>t.id==='addFriend');if(task&&!task.completed){task.completed=true;gameData.exp+=task.reward.exp;gameData.levelExp=(gameData.levelExp||0)+task.reward.exp;checkLevelUp();showModal('ğŸ“Œ','æ”¯çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);}}saveData();render();if(!isFirst)showModal('ğŸ¤','æ·»åŠ æˆåŠŸ!','æ–°æœ‹å‹: '+n);}
        function addBossEncounter(){const bosses=['æƒ°æ€§ä¹‹é¾™','é‡å¼€æ¶é­”','é—å¿˜ä¹‹é›¾','æ¯”è¾ƒå·¨äºº','èˆ’é€‚é™·é˜±'];const idx=prompt('å“ªä¸ªBoss? 1-æƒ°æ€§ä¹‹é¾™ 2-é‡å¼€æ¶é­” 3-é—å¿˜ä¹‹é›¾ 4-æ¯”è¾ƒå·¨äºº 5-èˆ’é€‚é™·é˜±');if(!idx)return;const won=confirm('ä½ èµ¢äº†å—?');const isFirst=gameData.bossEncounters.length===0;gameData.bossEncounters.push({date:new Date().toLocaleDateString('zh-CN'),boss:bosses[parseInt(idx)-1]||`Boss${idx}`,won});if(won){gameData.exp+=20;gameData.levelExp=(gameData.levelExp||0)+20;if(isFirst&&gameData.tasks.side){const task=gameData.tasks.side.find(t=>t.id==='defeatBoss');if(task&&!task.completed){task.completed=true;gameData.exp+=task.reward.exp;gameData.levelExp+=task.reward.exp;checkLevelUp();showModal('ğŸ“Œ','æ”¯çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);}}checkLevelUp();}saveData();render();if(!isFirst)showModal(won?'âš”ï¸':'ğŸ’€',won?'èƒœåˆ©!':'å¤±è´¥',won?'+20 EXP':'ä¸‹æ¬¡åŠ æ²¹!');}
        function quickLog(){document.querySelector('[data-section="daily"]').click();window.scrollTo({top:0,behavior:'smooth'});}
        function showModal(i,t,d){document.getElementById('modalIcon').textContent=i;document.getElementById('modalTitle').textContent=t;document.getElementById('modalDesc').textContent=d;document.getElementById('modal').classList.add('show');}
        function closeModal(){document.getElementById('modal').classList.remove('show');}
        
        // ç­‰çº§ç³»ç»Ÿ - å‰æœŸå®¹æ˜“åæœŸéš¾ï¼Œå‡çº§æ—¶è§£é”ä¸»çº¿ä»»åŠ¡
        function checkLevelUp(){
            if(!gameData.level)gameData.level=1;
            if(!gameData.levelExp)gameData.levelExp=0;
            
            // v5.0 æ–°ç»éªŒæ›²çº¿ï¼ˆ90å¤©å¹³è¡¡ï¼‰
            let expNeeded;
            const level=gameData.level;
            if(level<=3)expNeeded=150;        // é»‘é“ Lv.1-3
            else if(level<=7)expNeeded=200;   // é»„é“œ Lv.4-7
            else if(level<=11)expNeeded=300;  // ç™½é“¶ Lv.8-11
            else if(level<=15)expNeeded=400;  // é»„é‡‘ Lv.12-15
            else if(level<=19)expNeeded=500;  // é“‚é‡‘ Lv.16-19
            else if(level<=23)expNeeded=600;  // é’»çŸ³ Lv.20-23
            else if(level<=26)expNeeded=700;  // å¤§å¸ˆ Lv.24-26
            else if(level===27||level===28)expNeeded=800;  // å®—å¸ˆ Lv.27-28
            else if(level===29)expNeeded=1000; // å®—å¸ˆI Lv.29
            else expNeeded=1500;              // ç‹è€… Lv.30
            
            if(gameData.levelExp>=expNeeded){
                gameData.level++;
                gameData.levelExp-=expNeeded;
                gameData.hp=Math.min(100,gameData.hp+10);
                gameData.mp=Math.min(100,gameData.mp+10);
                for(let attr in gameData.attributes){
                    gameData.attributes[attr]=Math.min(100,gameData.attributes[attr]+2);
                }
                
                // è§£é”å½“å‰ç­‰çº§çš„ä¸»çº¿ä»»åŠ¡
                if(gameData.tasks.main){
                    let unlocked=[];
                    gameData.tasks.main.forEach(task=>{
                        if(task.level===gameData.level&&!task.unlocked){
                            task.unlocked=true;
                            unlocked.push(task.name);
                        }
                    });
                    if(unlocked.length>0){
                        showModal('ğŸ¯','æ–°ä¸»çº¿è§£é”!',`Lv.${gameData.level}ä¸»çº¿ä»»åŠ¡å·²è§£é”: ${unlocked.join(', ')}`);
                    }else{
                        showModal('â­','å‡çº§äº†!','æ­å–œå‡åˆ°Lv.'+gameData.level+'! HP+10, MP+10, å…¨å±æ€§+2');
                    }
                }else{
                    showModal('â­','å‡çº§äº†!','æ­å–œå‡åˆ°Lv.'+gameData.level+'! HP+10, MP+10, å…¨å±æ€§+2');
                }
                
                saveData();
                checkLevelUp();
            }
        }
        
        // åˆ é™¤åŠŸèƒ½
        function deleteFamily(index){
            if(confirm('ç¡®å®šåˆ é™¤è¿™ä½å®¶äººå—?')){
                if(!gameData.family)gameData.family=[];
                gameData.family.splice(index,1);
                saveData();
                render();
            }
        }
        
        function deleteCommunity(index){
            if(confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªç¤¾ç¾¤å—?')){
                gameData.communities.splice(index,1);
                saveData();
                render();
            }
        }
        
        function deleteFriend(index){
            if(confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªæœ‹å‹å—?')){
                gameData.friends.splice(index,1);
                saveData();
                render();
            }
        }
        
        // æ”¯çº¿ä»»åŠ¡å®Œæˆ
        function toggleSideTask(index){
            if(!gameData.tasks.side)return;
            const task=gameData.tasks.side[index];
            if(task.completed)return;
            task.completed=true;
            gameData.exp+=task.reward.exp;
            gameData.levelExp=(gameData.levelExp||0)+task.reward.exp;
            checkLevelUp();
            saveData();
            render();
            showModal('ğŸ“Œ','æ”¯çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);
        }
        
        // è´¢åŠ¡ç³»ç»Ÿ
        function addTransaction(){
            const amount=parseFloat(document.getElementById('transactionAmount').value);
            const item=document.getElementById('transactionItem').value||'æœªå‘½åå•†å“';
            const type=document.querySelector('#finance .rating-selector .selected')?.dataset.value;
            const category=document.querySelector('#categorySelector .selected')?.dataset.value||'other';
            const platform=document.querySelector('#platformSelector .selected')?.dataset.value||'other';
            const necessity=document.querySelector('#necessitySelector .selected')?.dataset.value||'want';
            const note=document.getElementById('transactionNote').value||'';
            
            if(!amount||amount<=0){showModal('âŒ','é”™è¯¯','è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢');return;}
            if(!type){showModal('âŒ','é”™è¯¯','è¯·é€‰æ‹©æ”¶å…¥/æ”¯å‡ºç±»å‹');return;}
            
            if(!gameData.transactions)gameData.transactions=[];
            if(!gameData.shoppingCart)gameData.shoppingCart=[];
            if(!gameData.money)gameData.money=0;
            if(!gameData.totalExpense)gameData.totalExpense=0;
            
            if(type==='income'){
                gameData.money+=amount;
                gameData.totalIncome+=amount;
            }else{
                gameData.money-=amount;
                gameData.totalExpense+=amount;
                // v5.0 ä¿å­˜åˆ°è´­ç‰©è½¦ï¼ˆä»…æ”¯å‡ºï¼‰
                gameData.shoppingCart.push({
                    item,
                    amount,
                    category,
                    platform,
                    necessity,
                    note,
                    date:new Date().toLocaleDateString('zh-CN'),
                    time:new Date().toLocaleTimeString('zh-CN')
                });
            }
            
            gameData.transactions.push({
                amount,
                type,
                item,
                category,
                platform,
                necessity,
                note,
                date:new Date().toLocaleDateString('zh-CN')
            });
            
            document.getElementById('transactionAmount').value='';
            document.getElementById('transactionItem').value='';
            document.getElementById('transactionNote').value='';
            document.querySelectorAll('#finance .rating-selector .rating-btn').forEach(b=>b.classList.remove('selected'));
            document.querySelectorAll('#categorySelector .rating-btn').forEach(b=>b.classList.remove('selected'));
            document.querySelectorAll('#platformSelector .rating-btn').forEach(b=>b.classList.remove('selected'));
            document.querySelectorAll('#necessitySelector .rating-btn').forEach(b=>b.classList.remove('selected'));
            
            saveData();
            render();
            showModal('ğŸ’°','è®°å½•æˆåŠŸ',(type==='income'?'+Â¥':'-Â¥')+amount.toFixed(2)+'\n'+item);
        }
        
        function setInitialMoney(){
            const amount=parseFloat(document.getElementById('initialMoney').value);
            if(isNaN(amount)){showModal('âŒ','é”™è¯¯','è¯·è¾“å…¥æœ‰æ•ˆé‡‘é¢');return;}
            gameData.money=amount;
            document.getElementById('initialMoney').value='';
            saveData();
            render();
            showModal('ğŸ’°','è®¾ç½®æˆåŠŸ','åˆå§‹é‡‘é’±: Â¥'+amount.toFixed(2));
        }
        
        // ç¬”è®°ç³»ç»Ÿ
        function addNote(){
            const title=document.getElementById('noteTitle').value;
            const content=document.getElementById('noteContent').value;
            if(!title||!content){showModal('âŒ','é”™è¯¯','è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');return;}
            if(!gameData.notes)gameData.notes=[];
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€ç¯‡ç¬”è®°
            const isFirst=gameData.notes.length===0;
            
            gameData.notes.push({title,content,date:new Date().toLocaleDateString('zh-CN')});
            document.getElementById('noteTitle').value='';
            document.getElementById('noteContent').value='';
            
            // å®Œæˆæ”¯çº¿ä»»åŠ¡
            if(isFirst&&gameData.tasks.side){
                const task=gameData.tasks.side.find(t=>t.id==='writeNote');
                if(task&&!task.completed){
                    task.completed=true;
                    gameData.exp+=task.reward.exp;
                    gameData.levelExp=(gameData.levelExp||0)+task.reward.exp;
                    checkLevelUp();
                    showModal('ğŸ“Œ','æ”¯çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);
                }
            }
            
            saveData();
            render();
            if(!isFirst)showModal('ğŸ“','ä¿å­˜æˆåŠŸ','ç¬”è®°å·²ä¿å­˜');
        }
        
        function deleteNote(index){
            if(confirm('ç¡®å®šåˆ é™¤è¿™æ¡ç¬”è®°å—?')){
                gameData.notes.splice(index,1);
                saveData();
                render();
            }
        }
        
        // ç›®æ ‡ç³»ç»Ÿ
        function addGoal(){
            const text=document.getElementById('goalInput').value;
            if(!text){showModal('âŒ','é”™è¯¯','è¯·è¾“å…¥ç›®æ ‡å†…å®¹');return;}
            if(!gameData.goals)gameData.goals=[];
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªç›®æ ‡
            const isFirst=gameData.goals.length===0;
            
            gameData.goals.push({text,completed:false});
            document.getElementById('goalInput').value='';
            
            // å®Œæˆæ”¯çº¿ä»»åŠ¡
            if(isFirst&&gameData.tasks.side){
                const task=gameData.tasks.side.find(t=>t.id==='setGoal');
                if(task&&!task.completed){
                    task.completed=true;
                    gameData.exp+=task.reward.exp;
                    gameData.levelExp=(gameData.levelExp||0)+task.reward.exp;
                    checkLevelUp();
                    showModal('ğŸ“Œ','æ”¯çº¿å®Œæˆ!',`"${task.name}"å·²å®Œæˆ! +${task.reward.exp}EXP`);
                }
            }
            
            saveData();
            render();
            if(!isFirst)showModal('ğŸ¯','æ·»åŠ æˆåŠŸ','æ–°ç›®æ ‡å·²æ·»åŠ ');
        }
        
        function toggleGoal(index){
            gameData.goals[index].completed=!gameData.goals[index].completed;
            if(gameData.goals[index].completed){
                gameData.levelExp=(gameData.levelExp||0)+20;
                checkLevelUp();
                showModal('ğŸ¯','ç›®æ ‡å®Œæˆ!','è·å¾—20ç»éªŒå€¼');
            }
            saveData();
            render();
        }
        
        function deleteGoal(index){
            if(confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªç›®æ ‡å—?')){
                gameData.goals.splice(index,1);
                saveData();
                render();
            }
        }
        
        // æ•°æ®ç®¡ç†
        function exportData(){
            const dataStr=JSON.stringify(gameData,null,2);
            const blob=new Blob([dataStr],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');
            a.href=url;
            a.download='zhugehui_data_'+new Date().toISOString().split('T')[0]+'.json';
            a.click();
            showModal('ğŸ“¤','å¯¼å‡ºæˆåŠŸ','æ•°æ®å·²å¯¼å‡º');
        }
        
        function importData(){
            const input=document.createElement('input');
            input.type='file';
            input.accept='.json';
            input.onchange=e=>{
                const file=e.target.files[0];
                const reader=new FileReader();
                reader.onload=event=>{
                    try{
                        const data=JSON.parse(event.target.result);
                        gameData=data;
                        saveData();
                        render();
                        showModal('ğŸ“¥','å¯¼å…¥æˆåŠŸ','æ•°æ®å·²å¯¼å…¥');
                    }catch(err){
                        showModal('âŒ','å¯¼å…¥å¤±è´¥','æ–‡ä»¶æ ¼å¼é”™è¯¯');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function resetData(){
            if(confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')){
                if(confirm('å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦åˆ é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ')){
                    localStorage.removeItem('zhugehui_xmas2');
                    gameData={...defaultData};
                    saveData();
                    render();
                    showModal('ğŸ”„','é‡ç½®æˆåŠŸ','æ•°æ®å·²é‡ç½®');
                }
            }
        }
        
        // ==================== äº‹ä»¶ç›‘å¬å™¨è®¾ç½® ====================
        document.querySelectorAll('.nav-tab').forEach(t=>{
            t.addEventListener('click',()=>{
                document.querySelectorAll('.nav-tab').forEach(x=>x.classList.remove('active'));
                document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
                t.classList.add('active');
                document.getElementById(t.dataset.section).classList.add('active');
            });
        });
        
        document.querySelectorAll('.rating-selector').forEach(s=>{
            s.querySelectorAll('.rating-btn').forEach(b=>{
                b.addEventListener('click',()=>{
                    s.querySelectorAll('.rating-btn').forEach(x=>x.classList.remove('selected'));
                    b.classList.add('selected');
                    // v5.0 æ›´æ–°æ´»è·ƒåº¦
                    if(typeof updateActiveScore==='function')updateActiveScore();
                });
            });
        });
        
        // v5.0 ç›‘å¬è¾“å…¥æ¡†å˜åŒ–æ›´æ–°æ´»è·ƒåº¦
        ['wakeHour','wakeMinute'].forEach(id=>{
            document.getElementById(id).addEventListener('input',()=>{
                if(typeof updateActiveScore==='function')updateActiveScore();
            });
        });
        
        // ==================== åˆå§‹åŒ– ====================
        checkLoginReward(); // v5.0 æ£€æŸ¥è¿ç»­ç™»å½•
        render();setInterval(saveData,30000);
    </script>
</body>
</html>
